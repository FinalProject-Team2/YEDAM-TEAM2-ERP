<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout}">
<head>
<meta charset="UTF-8">
<title>미수상세관리</title>


<style>
/* 위 리스트 카드 아래쪽 여백 */
.arrear-list-area {
  margin-bottom: 16px;   /* 적당한 값으로 조절 (px, rem 모두 가능) */
}

/* 아래 상세 카드 위쪽 여백 (필요하면) */
.arrear-detail-area {
  margin-top: 0;         /* 기본 간격 없애고 싶으면 0, 더 띄우고 싶으면 값 조정 */
}


.lock-account-wrapper .card-title {
	font-weight: 600;
}

/* 공통 카드 헤더 (제목 왼쪽, 버튼 오른쪽) */
.card-header.with-actions {
	display: flex;
	justify-content: space-between;
	align-items: center;
}

.card-header-left h5.card-title {
	margin: 0;
	font-size: 1.05rem;
}

.card-header-right .btn+.btn {
	margin-left: .25rem;
}

/* Grid 영역 */
.lock-account-wrapper #accountGrid {
	width: 100%;
	margin-top: 4px;
}

/* 상단 헤더의 체크박스(행 헤더) 셀만 회색 */
.tui-grid-header-area .tui-grid-cell-row-header {
	background-color: #f5f5f5;
}

/* 데이터 행의 체크박스 셀은 흰색 유지 */
.tui-grid-body-area .tui-grid-cell-row-header {
	background-color: #ffffff;
}

/* 그리드 버튼 스타일 */
.grid-btn {
	padding: 4px 10px;
	border: 1px solid #bbb;
	background-color: #fff;
	border-radius: 4px;
	cursor: pointer;
	font-size: 12px;
}

.grid-btn:hover {
	background-color: #eee;
}
</style>
</head>

<body layout:fragment="content">
	<div class="lock-account-wrapper">

		<!-- 미수상세 조회 -->
		<div class="row mb-3">
			<div class="col-md-12">
				<div class="card">

					<!-- 카드 헤더 : 제목 + 초기화/조회 버튼 -->
					<div class="card-header with-actions">
						<div class="card-header-left">
							<h5 class="card-title">조회 조건</h5>
						</div>
						<div class="card-header-right">
							<button type="button" class="btn btn-dark">초기화</button>
							<button type="button" class="btn btn-outline-dark">조회</button>
						</div>
					</div>

					<!-- /card-body start -->
					<div class="card-body">
						<div class="row g-2">
							<div class="col-md-3">
								<label>고객사코드</label> <select class="form-select">
									<option>251125-001</option>
									<option>251125-002</option>
								</select>
							</div>
							<div class="col-md-3">
								<label>고객사명</label> <select class="form-select">
									<option>무신사</option>
									<option>29cm</option>
								</select>
							</div>
							<div class="col-md-3">
								<label>신용등급</label> <select class="form-select">
									<option>A</option>
									<option>B</option>
									<option>C</option>
									<option>D</option>
								</select>
							</div>
							<div class="col-md-3">
								<label>연체구분</label> <select class="form-select">
									<option>정상</option>
									<option>연체</option>
									<option>장기연체</option>
									<option>대손처리</option>
								</select>
							</div>
						</div>
					</div>
					<!-- /card-body end -->
				</div>
			</div>
		</div>
	</div>
	<!-- 미수/연체리스트 카드 -->
	<div class="row arrear-list-area">

		<!-- 미수/연체리스트 그리드 -->
		<div class="col-md-12 d-flex">
			<div class="card w-100 h-100">

				<!-- 카드 헤더 : 제목 + 잠금 해제 버튼 -->
				<div class="card-header with-actions">
						<h5 class="card-title">미수/연체리스트</h5>
					<div class="card-header-left">
					<button class="btn btn-outline-dark" id="openDelayModal">연체관리이력</button>
					</div>

				</div>

				<div class="card-body">
					<div class="priceGridWrap">
						<div id="detailGrid"></div>
					</div>
				</div>
			</div>
		</div>
	</div>


	<div th:replace="business/modal/delayModal :: delayModal"></div>
	
<script>
	function toNumber(val) {
	    if (val === null || val === undefined) return 0;
	    const str = String(val).replace(/,/g, '').trim();
	    if (str === '') return 0;
	    return Number(str) || 0;
	}

    // 2. 더미 데이터
    const detailData = [
        {
        	custcomId: '251126-0001',
        	custcomName: '무신사',
        	creditGrade: 'A',
        	delayFg: 'Y',
        	monthSaleAmt: '200,000,000',
        	basisAtmptBlce: '800,000,000',
        	recpt:'1,000,000,000',
        	atmptAmt:'N'
        },
        {
        	custcomId: '251126-0002',
        	custcomName: '29cm',
        	creditGrade: 'B',
        	delayFg: 'Y',
        	monthSaleAmt: '300,000,000',
        	basisAtmptBlce:'500,000,000',
        	recpt:'800,000,000',
        	atmptAmt:'N'
        }
    ];

    // 3. Grid 공통 옵션
    const businessGridOptions = {
        bodyHeight: 180,
        scrollX: false,
        scrollY: true,
        rowHeight: 40,
        autoWidth: true,
        columnOptions: {
            minWidth: 80,
            resizable: true
        }
    };

    // 4. 미수상세 목록 Grid 생성
    const detailGrid = new tui.Grid({
        el: document.getElementById('detailGrid'),
        data: detailData,
        ...businessGridOptions,
        columns: [
            { header: '고객코드', name: 'custcomId' },
            { header: '고객사', name: 'custcomName' },
            { header: '신용등급', name: 'creditGrade', width: 90, align: 'center' },
            {
	            header: '입금약속액',
	            name: 'rciptAppoAmt',
	            editor: 'text',
	            align: 'right',
	            formatter: ({value}) => {
	                const num = toNumber(value);
	                return num ? num.toLocaleString() : '';
	            }
       		},
        	{
	        	header: '입금약속일', 
	        	name: 'rciptAppoDt', 
	        	align: 'right',
	        	editor: 'text'
        	},
            { header: '연체구분', name: 'delayFg', width: 90, align: 'center' },
            { header: '당월매출금액', name: 'monthSaleAmt', align: 'right',
            	 formatter: ({value}) => {
 	                const num = toNumber(value);
 	                return num ? num.toLocaleString() : '';
 	            }
            },
            { header: '기초미수잔액', name: 'basicAtmptBlce', align: 'right',
            	 formatter: ({value}) => {
 	                const num = toNumber(value);
 	                return num ? num.toLocaleString() : '';
 	            }
            },
            { header: '수금', name: 'recpt', align: 'right',
           	 formatter: ({value}) => {
	                const num = toNumber(value);
	                return num ? num.toLocaleString() : '';
	            } 
           	},
           	{ header: '수금구분', name: 'recptFg', align: 'center'}, 
            { header: '미수금액', name: 'atmptAmt', align: 'right',
            	 formatter: ({value}) => {
 	                const num = toNumber(value);
 	                return num ? num.toLocaleString() : '';
 	            }
            },
           	{ header: '연체구분', name: 'delayFg', align: 'center'},
           	{ header: '상환여부', name: 'rpayAt', align: 'center'},
        ]
    });

   	// 연체이력관리 모달창
    const openDelayBtn = document.getElementById("openDelayModal");
    const DelayModal = document.getElementById("delayModal");
    const DelayModalClose = document.getElementById("delayModalClose");
    const DelayModalBackdrop = document.getElementById("delayModalBackdrop");

    // 연체이력관리 열기
    openDelayBtn.addEventListener("click", () => {
    delayModal.classList.add("show");
    delayModal.style.display = "block";
    delayModalBackdrop.style.display = "block";
    document.body.classList.add("modal-open");
    });
    
    

</script>
</body>
</html>
