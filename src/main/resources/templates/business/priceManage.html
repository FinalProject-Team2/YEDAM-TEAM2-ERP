 <!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout}">
<head>
<meta charset="UTF-8">

<title>ë‹¨ê°€ì •ì±…ê´€ë¦¬</title>


<style>
.lock-account-wrapper .card-title {
	font-weight: 600;
}

/* ê³µí†µ ì¹´ë“œ í—¤ë” (ì œëª© ì™¼ìª½, ë²„íŠ¼ ì˜¤ë¥¸ìª½) */
.card-header.with-actions {
	display: flex;
	justify-content: space-between;
	align-items: center;
}

.card-header-left h5.card-title {
	margin: 0;
	font-size: 1.05rem;
}

.card-header-right .btn+.btn {
	margin-left: .25rem;
}

/* Grid ì˜ì—­ */
.lock-account-wrapper #accountGrid {
	width: 100%;
	margin-top: 4px;
}

/* ìƒë‹¨ í—¤ë”ì˜ ì²´í¬ë°•ìŠ¤(í–‰ í—¤ë”) ì…€ë§Œ íšŒìƒ‰ */
.tui-grid-header-area .tui-grid-cell-row-header {
  background-color: #f5f5f5;
}

/* ë°ì´í„° í–‰ì˜ ì²´í¬ë°•ìŠ¤ ì…€ì€ í°ìƒ‰ ìœ ì§€ */
.tui-grid-body-area .tui-grid-cell-row-header {
  background-color: #ffffff;
}

/* ê·¸ë¦¬ë“œ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
.grid-btn {
    padding: 4px 10px;
    border: 1px solid #bbb;
    background-color: #fff;
    border-radius: 4px;
    cursor: pointer;
    font-size: 12px;
}
.grid-btn:hover {
    background-color: #eee;
}

</style>

</head>

<body layout:fragment="content">
	<div class="lock-account-wrapper">

		<!-- ë‹¨ê°€ì •ì±… ì¡°íšŒ -->
		<div class="row mb-3">
			<div class="col-md-12">
				<div class="card">

					<!-- ì¹´ë“œ í—¤ë” : ì œëª© + ì´ˆê¸°í™”/ì¡°íšŒ ë²„íŠ¼ -->
					<div class="card-header with-actions">
						<div class="card-header-left">
							<h5 class="card-title">ë‹¨ê°€ì •ì±… ì¡°íšŒ</h5>
						</div>
						<div class="card-header-right">
							<button type="button" class="btn btn-dark" id="btnSearchInit">ì´ˆê¸°í™”</button>
							<button type="button" class="btn btn-outline-dark" id="btnSearch">ì¡°íšŒ</button>
						</div>
					</div>

					<div class="card-body">
						<div class="row g-2">
							<div class="col-md-3">
								<label for="clientName" class="form-label">ë‹¨ê°€ì •ì±…ëª…</label>
								<input id="clientName" type="text" class="form-control" placeholder="YEDAM">
							</div>

							<div class="col-md-3">
							    <label class="form-label">ë‹¨ê°€ì •ì±…ìœ í˜•</label>
							    <select id="searchPriceType" class="form-select same-height price-type">
    								<option value="">ì „ì²´</option> <!-- ê¸°ë³¸ê°’ -->
							        <!-- ì—¬ê¸°ì— JSë¡œ ê³µí†µì½”ë“œ ì˜µì…˜ì´ ìë™ ì¶”ê°€ë¨ -->
							    </select>
							</div>

							<div class="col-md-3">
								<label for="userName" class="form-label">ì ìš©ì¼</label>
								<div class="input-group date" id="applyDatePicker">
								    <input type="text" class="form-control" id="applyDate" placeholder="ë‚ ì§œ ì„ íƒ">
								    <span class="input-group-text" id="icon-calendar">
								        <i class="bi bi-calendar"></i>
								    </span>
								</div>
							</div>

						</div>

					</div> <!-- /card-body -->
				</div>
			</div>
		</div>

		<!-- ë‹¨ê°€ì •ì±…ëª©ë¡ ì¹´ë“œ -->
		<div class="row">
		
			<!-- ë‹¨ê°€ì •ì±…ëª©ë¡ ê·¸ë¦¬ë“œ -->
			<div class="col-md-7 d-flex">
    			<div class="card w-100 h-100">

					<!-- ì¹´ë“œ í—¤ë” : ì œëª© + ì ê¸ˆ í•´ì œ ë²„íŠ¼ -->
					<div class="card-header with-actions">
						<div class="card-header-left">
							<h5 class="card-title">ë‹¨ê°€ì •ì±… ëª©ë¡</h5>
						</div>
						<div class="card-header-right">
<!-- 							<button type="button" class="btn btn-outline-dark" id="custcomBtn">ê³ ê°ì‚¬ì„¤ì •</button>
							<button type="button" class="btn btn-outline-dark" id="itemBtn">í’ˆëª©ì„¤ì •</button> -->
							<button type="button" class="btn btn-danger" id="btnDelete">ì‚­ì œ</button>
						</div>
					</div>

					<div class="card-body">
						<div class="priceGridWrap">
							<div id="priceGrid"></div>
						</div>
					</div>
				</div>
			</div>
			
			<!-- ë‹¨ê°€ì •ì±… ë“±ë¡í¼ -->
			<div class="col-md-5 d-flex">
    			<div class="card w-100 h-100">

					<!-- ì¹´ë“œ í—¤ë” : ì œëª© + ì´ˆê¸°í™”/ì¡°íšŒ ë²„íŠ¼ -->
					<div class="card-header with-actions">
						<div class="card-header-left">
							<h5 class="card-title">ë‹¨ê°€ì •ì±… ë“±ë¡</h5>
						</div>
						<div class="card-header-right">
							<button type="button" class="btn btn-dark" id="btnInsertInit">ì´ˆê¸°í™”</button>
							<button type="button" class="btn btn-outline-dark" id="btnInsertSave">ì €ì¥</button>
						</div>
					</div>

					<!-- ì •ì±…ë“±ë¡í¼ -->
					<div class="card-body d-flex flex-column justify-content-between">
						  <div class="row g-3">
							    <!-- ìœ„ìª½ ì˜ì—­ -->
							    <div class="col-12">
							      <label class="form-label">ë‹¨ê°€ì •ì±…ëª…</label>
							      <input id="priceName" type="text" class="form-control">
							    </div>
							
							    <!-- ì¤‘ê°„ : ìœ í˜• / í• ì¸ìœ¨ / ì ìš©ì¼ -->
							    <div class="col-md-6">
							      <div class="mb-3">
							        <label class="form-label">ë‹¨ê°€ì •ì±…ìœ í˜•</label>
								    <select id="formPriceType" class="form-select same-height price-type">
	   									<option value="">ì „ì²´</option> <!-- ê¸°ë³¸ê°’ -->
								        <!-- ì—¬ê¸°ì— JSë¡œ ê³µí†µì½”ë“œ ì˜µì…˜ì´ ìë™ ì¶”ê°€ë¨ -->
								    </select>
							      </div>
							    </div>
							    
							    <div class="col-md-6">
							      <div class="mb-3">
							        <label class="form-label">í• ì¸ìœ¨(%)</label>
							        <input id="percent" type="text" class="form-control same-height">
							      </div>
							    </div>
							
							    <div class="col-12">
							      <label>ì •ì±…ì ìš©ì¼</label>
		                            <div class="js-date-range d-flex align-items-center">
		                                <!-- ì‹œì‘ì¼ -->
										  <div class="input-group date">
										    <input type="text" class="form-control datepicker js-date-range-start" placeholder="ì ìš©ì‹œì‘ì¼">
										    <span class="input-group-text js-date-range-icon-start">
										      <i class="bi bi-calendar"></i>
										    </span>
										  </div>
										
										  <span class="mx-1 fw-bold fs-5">~</span>
										
										  <!-- ì¢…ë£Œì¼ -->
										  <div class="input-group date ms-2">
										    <input type="text" class="form-control datepicker js-date-range-end" placeholder="ì ìš©ì¢…ë£Œì¼">
										    <span class="input-group-text js-date-range-icon-end">
										      <i class="bi bi-calendar"></i>
										    </span>
										  </div>
		                            </div>
							
							    <!-- ì•„ë˜ : ë¹„ê³  (ì•„ë˜ìª½ì— ë¶™ë„ë¡) -->
							    <div class="col-12 mt-auto">
							      <label class="form-label">ë¹„ê³ </label>
							      <input id="rm" type="text" class="form-control">
							    </div>
							    
							    <input id="priceId" type="hidden">
							  </div>
						</div> <!-- ì •ì±…ë“±ë¡í¼ end -->
						
					</div>
				</div>
	
			</div><!-- ë‹¨ê°€ì •ì±… ë“±ë¡í¼ .End -->
		</div> <!-- ë‹¨ê°€ì •ì±…ëª©ë¡ì¹´ë“œ .End -->
	</div> <!-- lock-account-wrapper .End -->

	
<div th:replace="business/modal/custcomModal :: custcomModal"></div>
<div th:replace="business/modal/productModal :: productModal"></div>

<script>
	// 0. ë‹¨ê°€ì •ì±…ìœ í˜• ê³µí†µì½”ë“œ ë§¤í•‘
	const priceTypeMap = {}; // { p1: 'ê±°ë˜ì²˜ë³„', p2: 'í’ˆëª©ë³„' }

	
	// ê³µí†µì½”ë“œ(ë‹¨ê°€ì •ì±…ìœ í˜•) ë¡œë”© + select ì±„ìš°ê¸° + map ë§Œë“¤ê¸°
	function loadPriceTypeCodes() {
	    fetch('/price/type-codes')
	        .then(res => res.json())
	        .then(data => {
	            const selects = document.querySelectorAll('.price-type');
	
	            // select ì˜µì…˜ ì±„ìš°ê¸°
	            selects.forEach(select => {
	                data.forEach(item => {
	                    const opt = document.createElement('option');
	                    opt.value = item.codeId;       // p1, p2
	                    opt.textContent = item.codeNm; // ê±°ë˜ì²˜ë³„, í’ˆëª©ë³„
	                    select.appendChild(opt);
	                });
	            });
	
	            // map ì±„ìš°ê¸° (ê·¸ë¦¬ë“œ formatterì—ì„œ ì‚¬ìš©)
	            data.forEach(item => {
	                priceTypeMap[item.codeId] = item.codeNm;
	            });
	
	            // ê·¸ë¦¬ë“œê°€ ì´ë¯¸ ë§Œë“¤ì–´ì¡Œë‹¤ë©´ ë‹¤ì‹œ ê·¸ë¦¬ê¸°
	            if (window.priceGrid) {
	                window.priceGrid.refreshLayout();
	            }
	        })
	        .catch(err => console.error('ë‹¨ê°€ì •ì±…ìœ í˜• ì½”ë“œ ì¡°íšŒ ì˜¤ë¥˜:', err));
	}
	
	// DOM ì¤€ë¹„ë˜ë©´ ê³µí†µì½”ë“œë¶€í„° ë¡œë”©
	window.addEventListener('DOMContentLoaded', loadPriceTypeCodes);

	
	// 1. Toast UI Grid í…Œë§ˆ
	tui.Grid.applyTheme('default', {
		cell: {
			normal: {
			  border: '#dedede',
			  background: '#ffffff',
			  showVerticalBorder: true
			},
			header: {
			  border: '#dedede',
			  background: '#f5f5f5',
			  showVerticalBorder: true
			},
			// âœ… rowHeaderëŠ” ê¸°ë³¸ í°ìƒ‰ìœ¼ë¡œ ë‘ê¸° (í—¤ë”/ë°”ë”” ê³µí†µ)
			rowHeader: {
			  border: '#dedede',
			  background: '#ffffff',
			  showVerticalBorder: true
			},
			editable: {
			  background: '#FFFDF0',
			  text: '#000'
			},
			selectedHeader: {
			  background: '#f5f5f5'
			},
			selected: {
			  background: '#ffffff'
			}
		}
	}); // 1. ë



    // 2. ë°ì´í„°
    const priceData = []; // 2. ë
    
    
    // 2-1. ê²€ìƒ‰ì¡°ê±´
    const searchForm = {
    		clientName: document.getElementById('clientName'),
    	    searchPriceType: document.getElementById('searchPriceType'),
    	    applyDate: document.getElementById('applyDate')
	};

    
    // 3. Grid ê³µí†µ ì˜µì…˜
    const priceGridOptions = {
        bodyHeight: 340,
        scrollX: true,
        scrollY: true,  // ì„¸ë¡œ
        rowHeaders: ['checkbox'],     // ì¢Œì¸¡ ì²´í¬ë°•ìŠ¤
        columnOptions: {
            minWidth: 80,
            resizable: true
        }
    }; // 3. ë
    
 
    
    // 4. ë‹¨ê°€ì •ì±… ëª©ë¡ Grid ìƒì„±
    const priceGrid = new tui.Grid({
        el: document.getElementById('priceGrid'),
        data: priceData,
        ...priceGridOptions,
        columns: [
        	{ header: 'ID', name: 'priceId', hidden: true },
            { header: 'ë‹¨ê°€ì •ì±…ëª…', name: 'priceName', width: 180 },
            { header: 'ìœ í˜•', name: 'type', width: 80, align: 'center',
            	formatter: ({ value }) => {
                    return priceTypeMap[value] || value || '';
                    // priceTypeMapì— ìˆìœ¼ë©´ í•œê¸€ëª…, ì—†ìœ¼ë©´ ì›ë˜ ê°’(p1/p2) í‘œì‹œ
                }
            },
            {
           	  header: 'ê³ ê°ì‚¬ì„ íƒ',
           	  name: 'clientSelect',
           	  width: 120,
           	  align: 'center',
           	  formatter: ({ row }) => {
           	    // row.type ì´ p1ì¼ ë•Œë§Œ í™œì„± ë²„íŠ¼
           	    const disabled = row.type === 'p1' ? '' : 'disabled style="opacity:0.5;cursor:not-allowed;"';
           	    return `<button class="grid-btn open-client-modal-btn" ${disabled}>ê±°ë˜ì²˜ì„ íƒ</button>`;
           	  }
           	},
           	{
           	  header: 'í’ˆëª©ì„ íƒ',
           	  name: 'productSelect',
           	  width: 120,
           	  align: 'center',
           	  formatter: ({ row }) => {
           	    // row.type ì´ p2ì¼ ë•Œë§Œ í™œì„± ë²„íŠ¼
           	    const disabled = row.type === 'p2' ? '' : 'disabled style="opacity:0.5;cursor:not-allowed;"';
           	    return `<button class="grid-btn open-product-modal-btn" ${disabled}>í’ˆëª©ì„ íƒ</button>`;
           	  }
           	},
            { header: 'í• ì¸ìœ¨(%)', name: 'percent', width: 80, align: 'right' },
            { header: 'ì ìš©ì‹œì‘ì¼', name: 'beginDt', width: 120, align: 'right' },
            { header: 'ì ìš©ì¢…ë£Œì¼', name: 'endDt', width: 120, align: 'right' },
            { header: 'ë¹„ê³ ', name: 'rm', width: 'auto', minWidth: 250 },
        ]
    }); // 4. ë
    
    // ì „ì—­ì—ì„œ ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ windowì— ì˜¬ë ¤ë‘ê¸° (ìœ„ì—ì„œ window.priceGrid ì‚¬ìš©)
    window.priceGrid = priceGrid;
    
	// 5. í¼ ìš”ì†Œ ìºì‹±
	const priceForm = {
		priceId: document.getElementById('priceId'),
		priceName: document.getElementById('priceName'),
		priceType: document.getElementById('formPriceType'),
		percent: document.getElementById('percent'),
		beginDt: document.querySelector('.js-date-range-start'),
		endDt: document.querySelector('.js-date-range-end'),
		rm: document.getElementById('rm')
	
	}; // 5. ë

    // 6. í–‰ í´ë¦­ ì‹œ í¼ì— ë°ì´í„° ì„¸íŒ…
    	priceGrid.on('click', ev => {
    		
      // ë²„íŠ¼(ê±°ë˜ì²˜ì„¤ì •/í’ˆëª©ì„¤ì •) í´ë¦­ì€ ë¬´ì‹œ
      if (ev.columnName === 'clientSetting' || ev.columnName === 'itemSetting') {
        return;
      }

      const rowKey = ev.rowKey;
      if (rowKey == null) return;

      const row = priceGrid.getRow(rowKey);
      if (!row) return;

      // Grid ë°ì´í„° â†’ í¼ ë§¤í•‘
      priceForm.priceId.value = row.priceId || '';
      priceForm.priceName.value = row.priceName || '';
      priceForm.percent.value   = row.percent || '';

      // select ë°•ìŠ¤ëŠ” value ë¡œ ì§€ì •
      if (row.type) {
        priceForm.priceType.value = row.type;
      } else {
        priceForm.priceType.value = ''; // í•„ìš”ì‹œ ê¸°ë³¸ê°’
      }

      priceForm.beginDt.value = row.beginDt || '';
      priceForm.endDt.value   = row.endDt || '';
      priceForm.rm.value      = row.rm || '';
    }); // 6. ë
    
    
    // 7. ëª¨ë‹¬ í˜¸ì¶œ ë²„íŠ¼
    
    // 7-1 ê±°ë˜ì²˜ ì„ íƒ ëª¨ë‹¬
	const openBtn = document.getElementById("custcomBtn");
	const modal   = document.getElementById("custcomModal");
	const back    = document.getElementById("custcomBackdrop");
	
/*	
 	function openModal() {
	  if (!modal || !back) return;
	  modal.classList.add("show");
	  modal.style.display = "block";
	  back.style.display = "block";
	
	  // ğŸ‘‡ ëª¨ë‹¬ ì—´ë•Œ ìµœì´ˆ ë¡œë”© ì‹œ ë¹ˆ ë°ì´í„°ë¡œ ê·¸ë¦¬ë“œ ìƒì„±
	  if (!window.custcomGrid) {
	    loadCustcomGrid();
	  } else {
	    window.custcomGrid.refreshLayout();
	  }
	} // end openModal
	
	function closeModal() {
	  if (!modal || !back) return;
	  modal.classList.remove("show");
	  modal.style.display = "none";
	  back.style.display = "none";
	} // end closeModal
*/	
	
	function openCustcomModal() {
		modal.classList.add("show");
		modal.style.display = "block";
		back.style.display = "block";
		
		if (!window.custcomGrid) {
		  loadCustcomGrid();
		} else {
		  window.custcomGrid.refreshLayout();
		}
	}
	
	function closeCustcomModal() {
		modal.classList.remove("show");
		modal.style.display = "none";
		back.style.display = "none";
	}
	
	// ë°”ê¹¥ í´ë¦­ ì‹œ ë‹«ê¸°
	modal.addEventListener("click", (event) => {
		if (!event.target.closest(".modal-content")) {
		  closeCustcomModal();
		}
	});
	
	document.addEventListener('click', (e) => {

	  if (e.target.classList.contains('open-client-modal-btn')) {

	    const cell = priceGrid.getFocusedCell();
	    const row = cell ? priceGrid.getRow(cell.rowKey) : null;
	    if (!row) return;

	    // ìœ í˜•ì´ p1ì¼ ë•Œë§Œ ì˜¤í”ˆ
	    if (row.type !== 'p1') return;

	    // ë°”ê¹¥ ë²„íŠ¼ê³¼ ë™ì¼í•˜ê²Œ ëª¨ë‹¬ ì—´ê¸°
	    openCustcomModal();
	  }
	}); // end ê±°ë˜ì²˜ëª¨ë‹¬
	

	// 7-2 ìƒí’ˆ ì„ íƒ ëª¨ë‹¬
	const openProductBtn = document.getElementById("productBtn");
	const productModal   = document.getElementById("productModal");
	const productBack    = document.getElementById("productBackdrop");
	
/*	
 	function openModal() {
	  if (!productModal || !productBack) return;
	  productModal.classList.add("show");
	  productModal.style.display = "block";
	  productBack.style.display = "block";
	
	  // ğŸ‘‡ ëª¨ë‹¬ ì—´ë•Œ ìµœì´ˆ ë¡œë”© ì‹œ ë¹ˆ ë°ì´í„°ë¡œ ê·¸ë¦¬ë“œ ìƒì„±
	  if (!window.productGrid) {
	    loadProductGrid();
	  } else {
	    window.productGrid.refreshLayout();
	  }
	} // end openModal
	
	function closeModal() {
	  if (!productModal || !productBack) return;
	  productModal.classList.remove("show");
	  productModal.style.display = "none";
	  productBack.style.display = "none";
	} // end closeModal
*/	
	
	function openProductModal() {
		productModal.classList.add("show");
		productModal.style.display = "block";
		productBack.style.display = "block";
		
		if (!window.productGrid) {
		  loadProductGrid();
		} else {
		  window.productGrid.refreshLayout();
		}
	}
	
	function closeProductModal() {
		productModal.classList.remove("show");
		productModal.style.display = "none";
		productBack.style.display = "none";
	}
	
	productModal.addEventListener("click", (event) => {
		if (!event.target.closest(".modal-content")) {
		  closeProductModal();
		}
	});
	
	
	document.addEventListener('click', (e) => {

	  if (e.target.classList.contains('open-product-modal-btn')) {

	    const cell = priceGrid.getFocusedCell();
	    const row = cell ? priceGrid.getRow(cell.rowKey) : null;
	    if (!row) return;

	    // ìœ í˜•ì´ p2ì¼ ë•Œë§Œ ì˜¤í”ˆ
	    if (row.type !== 'p2') return;

	    // ë°”ê¹¥ ë²„íŠ¼ê³¼ ë™ì¼í•˜ê²Œ ëª¨ë‹¬ ì—´ê¸°
	    openProductModal();
	  }
	}); // end ìƒí’ˆëª¨ë‹¬

	 
    
    // 8. ì´ˆê¸°í™”ë²„íŠ¼ ì´ë²¤íŠ¸
    const $btnSearchInit = document.getElementById('btnSearchInit');
    const $btnInsertInit = document.getElementById('btnInsertInit');
    
    if ($btnSearchInit) {
        $btnSearchInit.addEventListener('click', function () {
            Object.values(searchForm).forEach(field => field.value = '');
        });
    }
    
    if ($btnInsertInit) {
        $btnInsertInit.addEventListener('click', function () {
            Object.values(priceForm).forEach(field => field.value = '');
        });
    } 
	    
    
 	// 9. ì¡°íšŒë²„íŠ¼ ì´ë²¤íŠ¸
    const $btnSearch = document.getElementById('btnSearch');

    if ($btnSearch) {
        $btnSearch.addEventListener('click', function () {

            const searchName = searchForm.clientName.value.trim();          // ë‹¨ê°€ì •ì±…ëª…
            const searchType = searchForm.searchPriceType.value;            // ìœ í˜•
            const applyDate = searchForm.applyDate.value;                   // ì ìš©ì¼
            
            console.log("ì¡°íšŒì¡°ê±´:", searchName, searchType, applyDate);

            axios.post('/price/list', {
                searchPriceName: searchName,
                searchType: searchType,
                searchApplcDt: applyDate
            })
            .then(res => {
                console.log("ì¡°íšŒê²°ê³¼:", res.data);

                // ê²°ê³¼ë¥¼ ê·¸ë¦¬ë“œì— ë°˜ì˜
                priceGrid.resetData(res.data);
            })
            .catch(err => {
                console.error("ì¡°íšŒ ì˜¤ë¥˜:", err);
            });

        });
    }
	    
	// 10. ì €ì¥ë²„íŠ¼ ì´ë²¤íŠ¸
	console.log(priceForm);
	
	document.getElementById('btnInsertSave').addEventListener('click', () => {

		  const payload = {
		    priceId: priceForm.priceId.value,
		    priceName: priceForm.priceName.value,
		    type: priceForm.priceType.value,
		    percent: priceForm.percent.value,
		    beginDt: priceForm.beginDt.value,
		    endDt: priceForm.endDt.value,
		    rm: priceForm.rm.value
		  };

		  fetch('/price/save', {
		      method: 'POST',
		      headers: { 'Content-Type': 'application/json' },
		      body: JSON.stringify(payload)
		  })
		  .then(res => res.json())
		  .then(result => {
		    if (result.success) {
		      alert('ì €ì¥ ì™„ë£Œ');

		      // í¼ ì´ˆê¸°í™”
		      document.getElementById('btnInsertInit').click();

		      // ê·¸ë¦¬ë“œ ìƒˆë¡œê³ ì¹¨
		      reloadPriceGrid();
		    } else {
		      alert(result.message || 'ì €ì¥ ì‹¤íŒ¨');
		    }
		  });
		});
	
	
	
	function reloadPriceGrid() {
		  fetch('/price/list')
		    .then(res => res.json())
		    .then(data => {
		      priceGrid.resetData(data);  // ê¸°ì¡´ ë°ì´í„° êµì²´
		    })
		    .catch(err => console.error('ê·¸ë¦¬ë“œ ì¬ì¡°íšŒ ì˜¤ë¥˜:', err));
		}
	
	// 11. ì‚­ì œë²„íŠ¼ ì´ë²¤íŠ¸
	document.getElementById("btnDelete").addEventListener("click", async () => {

	    const selectedRows = priceGrid.getCheckedRows();   // ë‹¤ê±´ ì„ íƒ
	    console.log("ì„ íƒëœ ROW:", selectedRows);
	
	    if (!selectedRows || selectedRows.length === 0) {
	        alert("ì‚­ì œí•  ë°ì´í„°ë¥¼ ì„ íƒí•˜ì„¸ìš”.");
	        return;
	    }
	
	    // ì„ íƒí•œ ë°ì´í„° count ë³´ì—¬ì£¼ê¸°
	    if (!confirm(`${selectedRows.length}ê±´ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
	        return;
	    }
	
	    // priceId ë°°ì—´ ë§Œë“¤ê¸°
	    const priceIdList = selectedRows.map(row => row.priceId);
	
	    const payload = {
	        priceIdList: priceIdList
	    };
	
	    try {
	        const response = await fetch("/price/delete", {
	            method: "POST",
	            headers: { "Content-Type": "application/json" },
	            body: JSON.stringify(payload)
	        });
	
	        const data = await response.json();
	        console.log("ì‚­ì œ ê²°ê³¼:", data);
	
	        if (data.result === "success") {
	            alert("ì‚­ì œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.");
	
	            reloadPriceGrid();   // ì¬ì¡°íšŒ
	            clearForm();         // í¼ ì´ˆê¸°í™”
	        } else {
	            alert("ì‚­ì œ ì‹¤íŒ¨: " + (data.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
	        }
	    } catch (err) {
	        console.error("ì‚­ì œ ìš”ì²­ ì˜¤ë¥˜:", err);
	        alert("ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
	    }
	});
	
	
	// 12. ê·¸ë¦¬ë“œ ìƒˆë¡œê³ ì¹¨ í•¨ìˆ˜
	async function reloadPriceGrid() {
	    const response = await fetch('/price/list', {
	        method: 'POST',
	        headers: { 'Content-Type': 'application/json' },
	        body: JSON.stringify({})
	    });
	
	    const data = await response.json();
	    priceGrid.resetData(data);
	}
	
	
	// clearForm í•¨ìˆ˜ ì¶”ê°€
	function clearForm() {
	    document.getElementById('priceId').value = "";
	    document.getElementById('priceName').value = "";
	    document.getElementById('percent').value = "";
	    document.getElementById('rm').value = "";
	    document.querySelector('.js-date-range-start').value = "";
	    document.querySelector('.js-date-range-end').value = "";
	    document.getElementById('formPriceType').value = "";
	}
	
// ---------------------------- ê±°ë˜ì²˜ ëª¨ë‹¬ ìŠ¤í¬ë¦½íŠ¸
	//1. ê·¸ë¦¬ë“œ ìƒì„±
	window.custcomGrid = null;

	function loadCustcomGrid(data = []) {
	  if (window.custcomGrid) {
	    window.custcomGrid.resetData(data);
	    return;
	  }
	
	  window.custcomGrid = new tui.Grid({
	    el: document.getElementById('custcomGrid'),
	    scrollX: false,
	    scrollY: true,
	    bodyHeight: 350,
	    rowHeaders: ['checkbox'],
	    columns: [
	      { header: 'ê³ ê°ì‚¬ëª…', name: 'custcomName', width: 200 },
	      { header: 'ë‹´ë‹¹ì', name: 'psch', width: 120 },
	      { header: 'ì—°ë½ì²˜', name: 'pschTel', width: 140 },
	      { header: 'ì£¼ì†Œ', name: 'bizAddr', width: 'auto', minWidth: 250 }
	    ]
	  });
	}

	// 2. ì¡°íšŒë²„íŠ¼ ê±°ë˜ì²˜ ì¡°íšŒ
	document.getElementById('searchCustcomBtn').addEventListener('click', () => {
	  const keyword = document.getElementById('custcomName').value;
	
	  fetch('/custcom/list', {
	    method: 'POST',
	    headers: { 'Content-Type': 'application/json' },
	    body: JSON.stringify({ custcomName: keyword })
	  })
	    .then(res => res.json())
	    .then(data => loadCustcomGrid(data))
	    .catch(err => console.error('ê³ ê°ì‚¬ ì¡°íšŒ ì˜¤ë¥˜:', err));
	});

	// 3. ì…ë ¥ë²„íŠ¼ ê±°ë˜ì²˜ ì…ë ¥
	document.getElementById('insertCustcomBtn').addEventListener('click', () => {
	  const checkedRows = window.custcomGrid.getCheckedRows();  // window ì‚¬ìš©

	  if (!checkedRows.length) {
	    alert("ì„ íƒëœ ê±°ë˜ì²˜ê°€ ì—†ìŠµë‹ˆë‹¤.");
	    return;
	  }

	  console.log("ì„ íƒëœ ê±°ë˜ì²˜ ëª©ë¡:", checkedRows);

	  bootstrap.Modal.getInstance(document.getElementById('custcomModal')).hide();
	});
	
	
	
// ---------------------------- ìƒí’ˆ ëª¨ë‹¬ ìŠ¤í¬ë¦½íŠ¸
	//1. ê·¸ë¦¬ë“œ ìƒì„±
	window.productGrid = null;

	function loadProductGrid(data = []) {
	  if (window.productGrid) {
	    window.productGrid.resetData(data);
	    return;
	  }
	
	  window.productGrid = new tui.Grid({
	    el: document.getElementById('productGrid'),
	    scrollX: false,
	    scrollY: true,
	    bodyHeight: 350,
	    rowHeaders: ['checkbox'],
	    columns: [
	      { header: 'ìƒí’ˆëª…', name: 'productName', width: 300 },
	      { header: 'ë‹¨ìœ„', name: 'unit', width: 152 },
	      { header: 'íŒë§¤ë‹¨ê°€', name: 'basisSaleAmt', width: 240, align: 'right' },
	    ]
	  });
	}

	// 2. ì¡°íšŒë²„íŠ¼ ê±°ë˜ì²˜ ì¡°íšŒ
	document.getElementById('searchProductBtn').addEventListener('click', () => {
	  const keyword = document.getElementById('productName').value;
	
	  fetch('/product/list', {
	    method: 'POST',
	    headers: { 'Content-Type': 'application/json' },
	    body: JSON.stringify({ productName: keyword })
	  })
	    .then(res => res.json())
	    .then(data => loadProductGrid(data))
	    .catch(err => console.error('ìƒí’ˆ ì¡°íšŒ ì˜¤ë¥˜:', err));
	});

	// 3. ì…ë ¥ë²„íŠ¼ ê±°ë˜ì²˜ ì…ë ¥
	document.getElementById('insertProductBtn').addEventListener('click', () => {
	  const checkedRows = window.productGrid.getCheckedRows();  // window ì‚¬ìš©

	  if (!checkedRows.length) {
	    alert("ì„ íƒëœ ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤.");
	    return;
	  }

	  console.log("ì„ íƒëœ ìƒí’ˆ ëª©ë¡:", checkedRows);

	  bootstrap.Modal.getInstance(document.getElementById('productModal')).hide();
	});
	
	
</script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

</body>
</html>
