<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
     xmlns:th="http://www.thymeleaf.org"
     xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
     layout:decorate="~{layout}">
<head>
<meta charset="UTF-8">
<script src="/assets/js/teamUtil.js"></script>
<title>ì—¬ì‹  ê´€ë¦¬</title>
<style type="text/css">
/* ê·¸ë¦¬ë“œ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
.grid-btn {
   padding: 4px 10px;
   border: 1px solid #bbb;
   background-color: #fff;
   border-radius: 4px;
   cursor: pointer;
   font-size: 12px;
}
.grid-btn:hover {
   background-color: #eee;
}
/* ì•…ì„±ì—¬ì‹  / ì¶œí•˜ì •ì§€ í‘œì‹œìš© ë°°ì§€ */
.bad-credit-badge {
   display: inline-block;
   padding: 2px 6px;
   font-size: 11px;
   border-radius: 4px;
   color: #fff;
   background-color: #dc3545; /* ë¹¨ê°„ìƒ‰ */
}
.ship-hold-badge {
   display: inline-block;
   padding: 2px 6px;
   font-size: 11px;
   border-radius: 4px;
   color: #fff;
   background-color: #343a40; /* ì§„í•œ íšŒìƒ‰ */
}
</style>
</head>
<body layout:fragment="content">
<div class="lock-account-wrapper">

   <!-- ì—¬ì‹  ì¡°íšŒ -->
   <div class="row mb-3">
       <div class="col-md-12">
           <div class="card">
           
               <!-- ì¹´ë“œ í—¤ë” : ì œëª© + ì´ˆê¸°í™”/ì¡°íšŒ ë²„íŠ¼ -->
               <div class="card-header with-actions">
                   <div class="card-header-left">
                       <h5 class="card-title">ê²€ìƒ‰ ì¡°ê±´</h5>
                   </div>
                   <div class="card-header-right">
                       <button type="button" class="btn btn-dark" id="creditInit">ì´ˆê¸°í™”</button>
                       <button type="button" class="btn btn-outline-dark" id="searchCredit">ì¡°íšŒ</button>
                   </div>
               </div>
               
               <!-- /card-body start -->
               <div class="card-body">
                   <div class="row">
                       <div class="col-md-4">
                           <label for="autoCustcomId" class="form-label">ê³ ê°ì½”ë“œ</label>
                           <div class="position-relative">
                               <input id="autoCustcomId" type="text" class="form-control"
                                      placeholder="ê³ ê°ì½”ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”" autocomplete="off">
                               <ul id="autoCustcomIdSuggest"
                                   class="list-group position-absolute w-100"
                                   style="z-index: 2000;">
                               </ul>
                           </div>
                       </div>
                       <div class="col-md-4">
                           <label for="autoCustcomName" class="form-label">ê³ ê°ì‚¬ëª…</label>
                           <div class="position-relative">
                               <input id="autoCustcomName" type="text" class="form-control"
                                      placeholder="ê³ ê°ì‚¬ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”" autocomplete="off">
                               <ul id="autoCustcomNameSuggest"
                                   class="list-group position-absolute w-100"
                                   style="z-index: 2000;">
                               </ul>
                           </div>
                       </div>
                   </div><!-- row end -->
               </div>
               <!-- /card-body end -->
           </div>
       </div>
   </div>
   <!-- ì—¬ì‹ í•œë„ ì¹´ë“œ -->
   <div class="row">
       <div class="col-md-12 d-flex">
           <div class="card w-100 h-100">
               <!-- ì¹´ë“œ í—¤ë” : ì œëª© + ë²„íŠ¼ -->
               <div class="card-header with-actions">
                   <div class="card-header-left">
                       <h5 class="card-title">ì—¬ì‹ í•œë„ì„¤ì • / ì—¬ì‹ í˜„í™©</h5>
                   </div>
                   <div class="card-header-right">
                       <!-- ì—¬ì‹  í‰ê°€ ë²„íŠ¼ ì¶”ê°€ -->
                       <!-- <button type="button" class="btn btn-outline-danger me-2" id="creditEval">ì—¬ì‹ í‰ê°€</button> -->
                       <!-- <button type="button" class="btn btn-outline-dark" id="newBtn">í–‰ì¶”ê°€</button> -->
                       <!-- <div th:replace="~{fragments/buttons :: addRowButton('MENU_SALES_006', 'newBtn')}"></div> -->
                       <button type="button" class="btn btn-dark" id="limitInit">ì´ˆê¸°í™”</button>
                       <!-- <button type="button" class="btn btn-outline-dark" id="saveBtn">ì €ì¥</button> -->
                       <div th:replace="~{fragments/buttons :: saveButton('MENU_SALES_006', 'saveBtn')}"></div>
                   </div>
               </div>
               <div class="card-body">
                   <!-- ê°„ë‹¨í•œ ë²”ë¡€ -->
                   <div class="mb-2" style="font-size: 12px;">
                       <span class="badge bg-secondary">â€» ì‚¬ìš©ë¥ (%) = ì›ê¸ˆì”ì•¡ / ì—¬ì‹ í•œë„ Ã— 100</span>
                       <!-- <span class="ms-2 bad-credit-badge">ì•…ì„±ì—¬ì‹ </span> -->
                       <span class="ms-2 ship-hold-badge">ì¶œí•˜ì •ì§€</span>
                   </div>
                   <div class="creditGridWrap">
                       <div id="creditGrid"></div>
                   </div>
               </div>
           </div>
       </div>
   </div>
   <!-- ê³ ê°ì‚¬ ìƒì„¸ ëª¨ë‹¬ -->
   <div th:replace="business/modal/creditCustModal :: creditModal"></div>
</div><!-- /.lock-account-wrapper -->
<script>
   
   // 1. ë”ë¯¸ ë°ì´í„° (ë°±ì—”ë“œì—ì„œ ë‚´ë ¤ì£¼ëŠ” ì»¬ëŸ¼ ì˜ˆì‹œ)
   // custcomId, custcomName, creditGrad, cdtlnCheck,
   // mrtggLmt, creditLmt, cdtlnLmt, lmtoverCheck,
   // applcBeginDt, applcEndDt,
   // remainAmt, maxOverdueMm, badCreditYn, shipHoldYn, turnoverDays
   const creditData = [];
   // 2. Grid ê³µí†µ ì˜µì…˜
   const businessGridOptions = {
       bodyHeight: 400,
       scrollX: true,
       scrollY: true,
       rowHeaders: [],
       rowHeight: 40,
       columnOptions: {
           minWidth: 80,
           resizable: true
       },
       // âœ… ì…€ ë”ë¸”í´ë¦­ ì‹œ í¸ì§‘ ì‹œì‘
       editingEvent: 'dblclick'
   };
   // ìˆ«ì ë³€í™˜ ìœ í‹¸ (ë¹ˆê°’/ì½¤ë§ˆ ì²˜ë¦¬)
   function toNumber(val) {
       if (val === null || val === undefined) return 0;
       const str = String(val).replace(/,/g, '').trim();
       if (str === '') return 0;
       return Number(str) || 0;
   }
   // 3. ì—¬ì‹ í•œë„ / ì—¬ì‹ í˜„í™© Grid ìƒì„±
   const creditGrid = new tui.Grid({
       el: document.getElementById('creditGrid'),
       data: creditData,
       ...businessGridOptions,
       columns: [
           { header: 'ê³ ê°ì½”ë“œ', name: 'custcomId', width: 120 },
           { header: 'ê³ ê°ì‚¬',   name: 'custcomName', width: 180 },
           {
               header: 'ê³ ê°ì‚¬ìƒì„¸ì¡°íšŒ',
               name: 'clientSelect',
               width: 120,
               align: 'center',
               formatter: ({ rowKey, row }) => {
                   const label = row.custcomNameResult || 'ê³ ê°ì‚¬ì¡°íšŒ';
                   return `
                     <button type="button"
                             class="grid-btn open-client-modal-btn"
                             data-row-key="${rowKey}"
                             data-custcom-id="${row.custcomId || ''}">
                       ${label}
                     </button>
                   `;
               }
           },
           // âœ… ì‹ ìš©ë“±ê¸‰: ë”ë¸”í´ë¦­ ì‹œ ì…€ë ‰íŠ¸ ë°•ìŠ¤ë¡œ í¸ì§‘
           {
               header: 'ì‹ ìš©ë“±ê¸‰',
               name: 'creditGrad',
               width: 90,
               align: 'center',
               editor: {
                 type: 'select',
                 options: {
                   listItems: [
                     { text: 'A', value: 'A' },
                     { text: 'B', value: 'B' },
                     { text: 'C', value: 'C' },
                     { text: 'D', value: 'D' }
                   ]
                 }
               }
             },
           // âœ… ì—¬ì‹ ì²´í¬: ë”ë¸”í´ë¦­ ì‹œ Y/N ì„ íƒ
           {
             header: 'ì—¬ì‹ ì²´í¬',
             name: 'cdtlnCheck',
             width: 90,
             align: 'center',
             editor: {
               type: 'select',
               options: {
                 listItems: [
                   { text: 'Y', value: 'Y' },
                   { text: 'N', value: 'N' }
                 ]
               }
             }
           },
           {
               header: 'ë‹´ë³´í•œë„',
               name: 'mrtggLmt',
               editor: 'text',
               width: 110,
               align: 'right',
               formatter: ({ value }) => {
                   const num = toNumber(value);
                   return num ? num.toLocaleString() : '';
               }
           },
           {
               header: 'ì‹ ìš©í•œë„',
               name: 'creditLmt',
               editor: 'text',
               width: 110,
               align: 'right',
               formatter: ({ value }) => {
                   const num = toNumber(value);
                   return num ? num.toLocaleString() : '';
               }
           },
           {
               header: 'ì—¬ì‹ í•œë„',
               name: 'cdtlnLmt',
               editor: 'text',
               width: 110,
               align: 'right',
               formatter: ({ value }) => {
                   const num = toNumber(value);
                   return num ? num.toLocaleString() : '';
               }
           },
           // í˜„ì¬ì”ì•¡ (ì¡°íšŒ ê²°ê³¼ ë‚´ë ¤ì˜¤ëŠ” ê°’, í•„ìš”í•˜ë©´ ì§ì ‘ ìˆ˜ì • ê°€ëŠ¥)
           {
             header: 'ì›ê¸ˆì”ì•¡',
             name: 'remainAmt',
             width: 110,
             align: 'right',
             editor: 'text',   // ì‚¬ìš©ìê°€ ì§ì ‘ ìˆ˜ì •í•  ìˆ˜ ìˆê²Œ í•˜ë ¤ë©´ ìœ ì§€, ì½ê¸°ì „ìš©ì´ë©´ ì‚­ì œ
             formatter: ({ value }) => {
               const num = toNumber(value);
               return num ? num.toLocaleString() : '';
             }
           },

           // ì‚¬ìš©ë¥  = í˜„ì¬ì”ì•¡ / ì—¬ì‹ í•œë„ * 100
           {
             header: 'ì‚¬ìš©ë¥ (%)',
             name: 'useRate',
             width: 90,
             align: 'right',
             formatter: ({ value }) => {
               if (value === null || value === undefined || value === '') return '';
               const num = Number(value);
               if (isNaN(num)) return '';
               return num.toFixed(1); // ì†Œìˆ˜ 1ìë¦¬
             }
           },
           {
               header: 'ìµœëŒ€ì—°ì²´(ê°œì›”)',
               name: 'maxOverdueMm',
               width: 110,
               align: 'right'
           },
           /* {
               header: 'ì•…ì„±ì—¬ì‹ ',
               name: 'badCreditYn',
               width: 80,
               align: 'center',
               formatter: ({ value }) => {
                   if (value === 'Y') {
                       return '<span class="bad-credit-badge">Y</span>';
                   }
                   return '';
               }
           }, */
           {
               header: 'ì¶œí•˜ì •ì§€',
               name: 'shipHoldYn',
               width: 120,
               align: 'center',
               formatter: ({ value }) => {
                   if (value === 'Y') {
                	   return `<button class="grid-btn ship-hold-btn" data-value="N">ì¶œí•˜í•´ì œ</button>`;
                   }
                   else{                	   
                   		return `<button class="grid-btn ship-hold-btn" data-value="Y">ì¶œí•˜ì •ì§€</button>`;
                   }
               }
               
           },
           {
               header: 'íšŒì „ì¼ìˆ˜',
               name: 'turnoverDays',
               width: 90,
               align: 'right'
           },
           /* â–² ì—¬ì‹ í˜„í™© ì»¬ëŸ¼ ë â–² */
           { header: 'í•œë„ì´ˆê³¼ì—¬ë¶€', name: 'lmtoverCheck', width: 110, align: 'center' },
           /* {
               header: 'ì ìš©ì‹œì‘ì¼',
               name: 'applcBeginDt',
               width: 130,
               editor: { type: 'datePicker', options: { format: 'yyyy-MM-dd', language: 'ko' } }
           },
           {
               header: 'ì ìš©ì¢…ë£Œì¼',
               name: 'applcEndDt',
               width: 130,
               editor: { type: 'datePicker', options: { format: 'yyyy-MM-dd', language: 'ko' } }
           } */
       ]
   });
   
   // ================================================================== ê·¸ë¦¬ë“œ ë‚´ ìë™ ê³„ì‚° í•¨ìˆ˜
   // ìˆ«ì ë³€í™˜ ìœ í‹¸ (ê¸°ì¡´ ê·¸ëŒ€ë¡œ ì‚¬ìš©)
   function toNumber(val) {
     if (val === null || val === undefined) return 0;
     const str = String(val).replace(/,/g, '').trim();
     if (str === '') return 0;
     return Number(str) || 0;
   }

    // ë‹´ë³´/ì‹ ìš©/í˜„ì¬ì”ì•¡ ë³€ê²½ ì‹œ ì—¬ì‹ í•œë„ & ì‚¬ìš©ë¥  ìë™ ê³„ì‚°
   creditGrid.on('afterChange', (ev) => {

     if (!ev.changes || ev.changes.length === 0) return;

     const affectedRowKeys = new Set();

     ev.changes.forEach(change => {
       const { rowKey, columnName, value } = change; 

       // 1) ë‹´ë³´í•œë„ ë˜ëŠ” ì‹ ìš©í•œë„ ë³€ê²½ ì‹œ â†’ ì—¬ì‹ í•œë„ = ë‹´ë³´ + ì‹ ìš©
       if (columnName === 'mrtggLmt' || columnName === 'creditLmt') {
         const row = creditGrid.getRow(rowKey);
         const mrtgg  = toNumber(row.mrtggLmt);
         const credit = toNumber(row.creditLmt);
         const total  = mrtgg + credit;

         creditGrid.setValue(rowKey, 'cdtlnLmt', total);
       } 
       
       
       // 1) ì‹ ìš©ë“±ê¸‰ ë³€ê²½ ì‹œ ìµœëŒ€ì—°ì²´(ê°œì›”) ìë™ ì„¤ì •
       if (columnName === 'credtGrad') {
           let maxMm = 1; // ê¸°ë³¸ê°’: C, D ë“±ê¸‰ì€ 1ê°œì›”
           if (value === 'A') {
               maxMm = 3;
           } else if (value === 'B') {
               maxMm = 2;
           }
           creditGrid.setValue(rowKey, 'maxOverdueMm', maxMm);
       }

       // 2) ì‚¬ìš©ë¥  ê³„ì‚°ì— ì˜í–¥ì„ ì£¼ëŠ” ì»¬ëŸ¼ì´ë©´ rowKey ê¸°ë¡
       if (columnName === 'mrtggLmt' ||
           columnName === 'creditLmt' ||
           columnName === 'cdtlnLmt' ||
           columnName === 'remainAmt') {
         affectedRowKeys.add(rowKey);
       }
     });

     
     // 3) ê° í–‰ë³„ë¡œ ì‚¬ìš©ë¥  ì¬ê³„ì‚°
     affectedRowKeys.forEach(rowKey => {
       const row    = creditGrid.getRow(rowKey);
       const limit  = toNumber(row.cdtlnLmt);   // ì—¬ì‹ í•œë„
       const remain = toNumber(row.remainAmt);  // í˜„ì¬ì”ì•¡

       let rate = 0;
       if (limit > 0) {
         rate = (remain / limit) * 100;
       }

       // useRate ì»¬ëŸ¼ì— 1ìë¦¬ ì†Œìˆ˜ë¡œ ì €ì¥
       creditGrid.setValue(rowKey, 'useRate', rate.toFixed(1));
     });
   });
   
   

   
   
   // 5-1 ê²€ìƒ‰ì¡°ê±´ ì´ˆê¸°í™” ë²„íŠ¼
   document.getElementById("creditInit").addEventListener("click", function () {
       const searchForm = { custcomId: "", custcomName: "" };
       document.querySelector("#autoCustcomId").value = "";
       document.querySelector("#autoCustcomName").value = "";
       console.log("ê²€ìƒ‰ì¡°ê±´ ì´ˆê¸°í™”:", searchForm);
   });
   // 5-2 ì¡°íšŒë²„íŠ¼
   $(document).on("click", "#searchCredit", function () {
       let searchForm = {
           custcomId: $("#autoCustcomId").val().trim(),
           custcomName: $("#autoCustcomName").val().trim()
       };
       console.log("ë³´ë‚¼ searchForm >>> ", searchForm);
       $.ajax({
           url: "/credit/list",
           type: "POST",
           contentType: "application/json",
           data: JSON.stringify(searchForm),
           success: function (res) {
               console.log("ì¡°íšŒê²°ê³¼ >>> ", res);
               creditGrid.resetData(res);
           },
           error: function (err) {
               console.error("ì¡°íšŒ ì¤‘ ì˜¤ë¥˜:", err);
           }
       });
   });
   // 5-3 ê³ ê°ì½”ë“œ ìë™ì™„ì„±
   if (window.TeamCommon && TeamCommon.autocomplete && typeof TeamCommon.autocomplete.init === 'function') {
       TeamCommon.autocomplete.init({
           inputSelector: '#autoCustcomId',
           listSelector: '#autoCustcomIdSuggest',
           url: '/credit/custcomIdSearch',
           paramName: 'keyword',
           minLength: 1,
           delay: 300,
           preventClose: true,
           mapResponse: item => ({
               id: item.customId,
               label: item.custcomId,
               value: item.custcomId,
               name: item.custcomName
           }),
           onSelect: item => {
               $('#autoCustcomId').val(item.value);
               $('#autoCustcomName').val(item.name);
           }
       });
   } else {
       console.warn('TeamCommon.autocomplete.init ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. teamUtil.js / autocomplete ìœ í‹¸ ë¡œë”© í™•ì¸');
   }
   // 5-4 ê³ ê°ì‚¬ëª… ìë™ì™„ì„±
   if (window.TeamCommon && TeamCommon.autocomplete && typeof TeamCommon.autocomplete.init === 'function') {
       TeamCommon.autocomplete.init({
           inputSelector: '#autoCustcomName',
           listSelector: '#autoCustcomNameSuggest',
           url: '/credit/custcomNameSearch',
           paramName: 'keyword',
           minLength: 1,
           delay: 300,
           preventClose: true,
           mapResponse: item => ({
               id: item.custcomId,
               label: item.custcomName,
               value: item.custcomName
           }),
           onSelect: item => {
               $('#autoCustcomName').val(item.value);
               $('#autoCustcomId').val(item.id);
           }
       });
   } else {
       console.warn('TeamCommon.autocomplete.init ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. teamUtil.js / autocomplete ìœ í‹¸ ë¡œë”© í™•ì¸');
   }
   // 6. ê³ ê°ì‚¬ì •ë³´ ëª¨ë‹¬
   const modal = document.getElementById("creditModal");
   const back  = document.getElementById("creditBackdrop");
   function openCreditModal() {
       modal.classList.add("show");
       modal.style.display = "block";
       back.style.display = "block";
   }
   function closeCreditModal() {
       modal.classList.remove("show");
       modal.style.display = "none";
       back.style.display = "none";
   }
   function resetCreditModalForm() {
       $('#bizAddr').val('');
       $('#bizTel').val('');
       $('#bizFax').val('');
       $('#psch').val('');
       $('#pschTel').val('');
       $('#pschEmail').val('');
   }
   modal.addEventListener("click", (event) => {
       if (!event.target.closest(".modal-content")) {
           closeCreditModal();
       }
   });
   document.addEventListener('click', (e) => {
	   // ê³ ê°ì‚¬ìƒì„¸ì¡°íšŒ ë²„íŠ¼ í´ë¦­
       if (e.target.classList.contains('open-client-modal-btn')) {
	       const custcomId = e.target.dataset.custcomId;
	       if (!custcomId) {
	           alert('ê³ ê°ì‚¬ ì½”ë“œê°€ ì—†ìŠµë‹ˆë‹¤.');
	           return;
	       }
	       resetCreditModalForm();
	       $.ajax({
	           url: '/credit/custcomDetail',
	           type: 'GET',
	           data: { custcomId: custcomId },
	           success: function (res) {
	               $('#bizAddr').val(res.bizAddr || '');
	               $('#bizTel').val(res.bizTel || '');
	               $('#bizFax').val(res.bizFax || '');
	               $('#psch').val(res.psch || '');
	               $('#pschTel').val(res.pschTel || '');
	               $('#pschEmail').val(res.pschEmail || '');
	               openCreditModal();
	           },
	           error: function (err) {
	               console.error('ì—…ì²´ì •ë³´ ì¡°íšŒ ì‹¤íŒ¨', err);
	               alert('ì—…ì²´ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.');
	           }
	       });
	      //ì¶œí•˜ì •ì§€ë²„íŠ¼ ëˆŒë €ì„ë•Œ
       } else if (e.target.classList.contains('ship-hold-btn')){
    	   $.ajax({
	           url: '/credit/shipmntStop',
	           type: 'PUT',
	           data: { custcomId: custcomId },
	           success: function (res) {
	           },
	           error: function (err) {
	               alert('ì¶œí•˜í•´ì œê°€ ë˜ì—ˆìŠµë‹ˆë‹¤.');
	           }
	       });
    	   
       }
	   
	   
   });
   // 7. ì—¬ì‹  í‰ê°€ ë²„íŠ¼ í´ë¦­ (ì•…ì„±ì—¬ì‹  / ì¶œí•˜ì •ì§€ ë“± ê³„ì‚° íŠ¸ë¦¬ê±°)
   $('#creditEval').on('click', function () {
       const searchForm = {
           custcomId: $("#autoCustcomId").val().trim(),
           custcomName: $("#autoCustcomName").val().trim()
       };
       if (!confirm('í˜„ì¬ ê²€ìƒ‰ì¡°ê±´ ê¸°ì¤€ìœ¼ë¡œ ì—¬ì‹  í‰ê°€ë¥¼ ì‹¤í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
           return;
       }
       $.ajax({
           url: '/credit/eval',          // ì—¬ì‹  í‰ê°€ìš© API (ë°±ì—”ë“œ êµ¬í˜„ í•„ìš”)
           type: 'POST',
           contentType: 'application/json',
           data: JSON.stringify(searchForm),
           success: function (res) {
               alert('ì—¬ì‹  í‰ê°€ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.\n(ì•…ì„±ì—¬ì‹  / ì¶œí•˜ì •ì§€ / íšŒì „ì¼ìˆ˜ ê°±ì‹ )');
               // í‰ê°€ í›„ ë‹¤ì‹œ ì¡°íšŒ
               $('#searchCredit').click();
           },
           error: function (err) {
               console.error('ì—¬ì‹  í‰ê°€ ì¤‘ ì˜¤ë¥˜', err);
               alert('ì—¬ì‹  í‰ê°€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
           }
       });
   });
   
   //8.í–‰ì¶”ê°€ ë²„íŠ¼
   document.getElementById("newBtn").addEventListener("click", function () {
	   const custcomId = document.querySelector("#autoCustcomId").value  ;
	   const custcomName = document.querySelector("#autoCustcomName").value ;
	   creditGrid.appendRow({custcomId, custcomName});
   })
   
   
	//9. modalSaveBtn(ì €ì¥ë²„íŠ¼) ì´ë²¤íŠ¸
	document.getElementById('saveBtn').addEventListener('click', () => {
	
	  const { updatedRows } = creditGrid.getModifiedRows();
	
	  if (!updatedRows || updatedRows.length === 0) {
	    alert('ì €ì¥í•  ë³€ê²½ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤.');
	    return;
	  }
	
	  // ğŸ‘‰ ì„œë²„ë¡œ ë³´ë‚¼ ë°ì´í„° ê°€ê³µ
	  const payload = updatedRows.map(row => ({
	    custcomId: row.custcomId,
	    creditGrad: row.creditGrad,
	    cdtlnCheck: row.cdtlnCheck,
	    mrtggLmt: toNumber(row.mrtggLmt),
	    creditLmt: toNumber(row.creditLmt),
	    cdtlnLmt: toNumber(row.cdtlnLmt)
	  }));
	
	  console.log('ì €ì¥ payload:', payload); // â­ ë””ë²„ê¹…ìš©
	
	  axios.post('/credit/save', payload)
	    .then(res => {
	      if (res.data.result === 'success') {
	        alert('ì €ì¥ ì™„ë£Œ');
	        creditGrid.clearModifiedData(); // â­ ë³€ê²½ ìƒíƒœ ì´ˆê¸°í™”
	      } else {
	        alert(res.data.message || 'ì €ì¥ ì‹¤íŒ¨');
	      }
	    })
	    .catch(err => {
	      console.error(err);
	      alert('ì €ì¥ ì¤‘ ì˜¤ë¥˜ ë°œìƒ');
	    });
	});
	/* document.getElementById("saveBtn").addEventListener("click", function () {
	
	    const payload = creditGrid.getModifiedRows().createdRows[0];
	
	    console.log("ì €ì¥ payload >>> ", payload);
	
	    axios.post("/credit/save", payload)
	        .then(res => {
	            console.log("ì €ì¥ ê²°ê³¼ >>> ", res.data);
	
	            if (res.data.result === "success") {
	                alert("ì €ì¥ ì™„ë£Œ");

	                closeNewCustModal();
	                $("#searchBtn").click();

	            } else {
	                alert("ì €ì¥ ì‹¤íŒ¨\n" + (res.data.message || ""));
	            }
	        })
	        .catch(err => {
	            console.error("ì €ì¥ ì¤‘ ì˜¤ë¥˜:", err);
	            alert("ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
	        });
	}); */

</script>
</body>
</html>

