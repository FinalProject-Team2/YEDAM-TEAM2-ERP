<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
  <meta charset="UTF-8">

  <!-- Toast UI Grid -->
  <link rel="stylesheet" href="https://uicdn.toast.com/grid/latest/tui-grid.css" />
  <script src="https://uicdn.toast.com/grid/latest/tui-grid.js"></script>

  <title>salyLedg</title>

  <style>
    .saly-tab-wrapper {
      margin-bottom: 0;
    }

    .saly-tab-wrapper .nav-tabs {
      display: flex;
      gap: 0;
      margin-bottom: 0;
      border-bottom: none !important;
    }

    .saly-tab-wrapper .nav-item {
      margin-bottom: -1px;
    }

    .saly-tab-wrapper .nav-link {
      border-radius: 10px 10px 0 0;
      padding: 8px 20px;
      background-color: #f7f8fa;
      color: #a1a6ad;
      font-weight: 500;
      border: 1px solid #d1d5db;
      border-bottom-color: #d1d5db;
      box-shadow: inset 0 -2px 0 rgba(0,0,0,0.03);
      transition: background-color 0.15s ease,
                  color 0.15s ease,
                  box-shadow 0.15s ease;
    }

    .saly-tab-wrapper .nav-item + .nav-item .nav-link {
      margin-left: -1px;
    }

    .saly-tab-wrapper .nav-link:not(.active):hover {
      background-color: #eff1f4;
      color: #7a7f87;
    }

    .saly-tab-wrapper .nav-link.active {
      background-color: #ffffff;
      color: #111111;
      font-weight: 600;
      border-color: #d1d5db;
      border-bottom-color: #ffffff;
      box-shadow: 0 4px 10px rgba(0,0,0,0.06);
      z-index: 2;
    }

    .saly-card-body > .mt-2 {
      margin-top: 0 !important;
    }
  </style>
</head>
<body layout:fragment="content">
<div class="row">
  <!-- 검색조건 -->
  <div class="col-md-12">
    <div class="card mb-3">
      <div class="card-header">
        <h5 class="card-title">검색조건</h5>
        <div class="card-header-right">
          <button class="btn btn-outline-dark" id="btnSearch">조회</button>
        </div>
      </div>
      <div class="card-body">
        <div class="row">
          <!-- 급여대장명칭 -->
          <div class="col-md-2">
            <label class="form-label">급여대장명칭</label>
            <input type="text" id="srchSalyNm" class="form-control">
          </div>
          <!-- 지급일자 기간 -->
          <div class="col-md-4">
            <label class="form-label">지급일자</label>
            <div class="d-flex align-items-center js-date-range">
              <div class="input-group date me-2">
                <input type="text"
                       class="form-control js-date-range-start"
                       id="payDtStart"
                       placeholder="날짜 선택">
                <span class="input-group-text js-date-range-icon-start">
                  <i class="bi bi-calendar"></i>
                </span>
              </div>
              <span class="mx-1 fw-bold fs-5">~</span>
              <div class="input-group date ms-2">
                <input type="text"
                       class="form-control js-date-range-end"
                       id="payDtEnd"
                       placeholder="날짜 선택">
                <span class="input-group-text js-date-range-icon-end">
                  <i class="bi bi-calendar"></i>
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- 급여목록 -->
    <div class="card">
      <div class="card-header">
        <h5 class="card-title mb-0">급여목록</h5>
        <div class="card-header-right d-flex gap-2">
          <!-- <button class="btn btn-outline-dark" id="btnSalyCalc">급여계산</button> -->
          <div th:replace="~{fragments/buttons :: calcButton('MENU_HR_008', 'btnSalyCalc')}"></div>
          <button class="btn btn-outline-dark" id="btnSalySpec">명세서 조회</button>
          <!-- <button class="btn btn-outline-dark" id="openSalyRegistModal">등록/수정</button> -->
          <div th:replace="~{fragments/buttons :: regButton('MENU_HR_008', 'openSalyRegistModal')}"></div>
          <!-- <button class="btn btn-outline-dark" id="btnToggleConfirm">확정/취소</button> -->
          <div th:replace="~{fragments/buttons :: confirmButton('MENU_HR_008', 'btnToggleConfirm')}"></div>
          <!-- <button class="btn btn-danger" id="btnSalyDelete">삭제</button> -->
          <div th:replace="~{fragments/buttons :: deleteButton('MENU_HR_008', 'btnSalyDelete')}"></div>
        </div>
      </div>
      <div class="card-body saly-card-body">
        <div class="saly-tab-wrapper">
          <ul class="nav nav-tabs" id="salyStatusTabs">
            <li class="nav-item">
              <button class="nav-link active" type="button" data-status="BEFORE_PAY">
                지급전
              </button>
            </li>
            <li class="nav-item">
              <button class="nav-link" type="button" data-status="PAID">
                지급완료
              </button>
            </li>
          </ul>
        </div>

        <div id="grid" class="mt-2"></div>
      </div>
    </div>
  </div>
</div>

<!-- 모달 include -->
<div th:replace="insa/modal/salyRegistModal :: salyRegistModal"></div>

<script>
  /***********************
   * 0. 공통: 부서 셀렉트 로딩 (모달용만 사용)
   ***********************/
  function loadDeptOptions() {
    const modalDept  = document.getElementById("salyDept");

    if (modalDept) {
      modalDept.innerHTML = '<option value="">전체</option>';
    }

    fetch('/insa/edc/inputOption')
      .then(res => res.json())
      .then(data => {
        const deptList = data.dept || [];
        deptList.forEach(d => {
          if (modalDept) {
            const opt2 = document.createElement("option");
            opt2.value = d.deptId;
            opt2.textContent = d.deptNm;
            modalDept.appendChild(opt2);
          }
        });
      })
      .catch(() => {
        alert("부서 목록을 불러오는 중 오류가 발생했습니다.");
      });
  }

  /***********************
   * 1. 메인 그리드 데이터
   ***********************/
  let originalGridData = [];
  let currentTabStatus = "BEFORE_PAY"; // BEFORE_PAY / PAID
  let gridData = [];

  /***************************
   * 2. 메인 급여대장 TUI Grid
   ***************************/
  const grid = new tui.Grid({
    el: document.getElementById("grid"),
    data: gridData,
    bodyHeight: 408,
    scrollX: false,
    scrollY: true,
    rowHeaders: [],
    columns: [
      {
        header: "",
        name: "선택",
        width: 50,
        align: "center",
        formatter: ({ rowKey }) => {
          return `<input type="radio" name="salyLedgRadio" data-row-key="${rowKey}" />`;
        }
      },
      { header: "귀속연월",     name: "revsMmdd",   align: "center" },
      { header: "지급일",       name: "payDt",      align: "center" },
      { header: "급여대장명칭", name: "salyLedgNm" },
      { header: "인원수",       name: "rcnt",       align: "right" },
      {
        header: "지급총액",
        name: "ttPayAmt",
        align: "right",
        formatter: ({ value }) => {
          if (value == null || value === "") return "";
          return Number(value).toLocaleString("ko-KR", {
            minimumFractionDigits: 2,
            maximumFractionDigits: 2
          });
        }
      },
      {
        header: "상태",
        name: "salyLedgStNm",
        align: "center"
      }
    ]
  });

  /************************
   * 3. DB에서 급여대장 목록 조회
   ************************/
  function loadSalyList() {
    const salyNmInput    = document.getElementById("srchSalyNm");
    const payDtStartInput = document.getElementById("payDtStart");
    const payDtEndInput   = document.getElementById("payDtEnd");

    const salyNm    = salyNmInput ? salyNmInput.value.trim() : "";
    const payDtStart = payDtStartInput ? payDtStartInput.value.trim() : "";
    const payDtEnd   = payDtEndInput ? payDtEndInput.value.trim() : "";

    const params = new URLSearchParams();
    if (salyNm)    params.append("salyLedgNm", salyNm);
    if (payDtStart) params.append("payDtStart", payDtStart);
    if (payDtEnd)   params.append("payDtEnd", payDtEnd);

    fetch("/insa/saly/list?" + params.toString())
      .then(res => {
        if (!res.ok) {
          throw new Error("급여대장 목록 조회 실패 (HTTP " + res.status + ")");
        }
        return res.json();
      })
      .then(list => {
        originalGridData = (list || []).map(r => {
          let revsMmdd = "";
          if (r.revsYm) {
            revsMmdd = String(r.revsYm);
          }

          let payDtStr = "";
          if (r.payDt) {
            let raw = String(r.payDt);
            if (raw.includes("T")) {
              raw = raw.substring(0, 10);
            }
            payDtStr = raw;
          }

          return {
            salyLedgId : r.salyLedgId,
            revsMmdd   : revsMmdd,
            payDt      : payDtStr,
            salyLedgNm : r.salyLedgNm,
            rcnt       : r.rcnt,
            salyLedgSt : r.salyLedgSt,
            salyLedgStNm: r.salyLedgStNm || "",
            ttPayAmt   : r.ttPayAmt
          };
        });

        applyTabFilter();
      })
      .catch(err => {
        console.error("급여대장 목록 조회 오류", err);
        alert("급여대장 목록 조회 중 오류가 발생했습니다.");
      });
  }

  document.getElementById("btnSearch")?.addEventListener("click", loadSalyList);

  /*************************
   * 4. 라디오 선택 헬퍼
   *************************/
  function getSelectedRow() {
    const checked = document.querySelector('input[name="salyLedgRadio"]:checked');
    if (!checked) return null;
    const rowKey = Number(checked.dataset.rowKey);
    const row = grid.getRow(rowKey);
    if (!row) return null;
    return { rowKey, row };
  }

  /*************************
   * 5. 탭으로 지급전 / 지급완료 분리
   *************************/
  const statusTabs         = document.querySelectorAll("#salyStatusTabs .nav-link");
  const btnSalyDelete      = document.getElementById("btnSalyDelete");
  const btnSalyCalc        = document.getElementById("btnSalyCalc");
  const btnSalySpec        = document.getElementById("btnSalySpec");
  const btnToggleConfirm   = document.getElementById("btnToggleConfirm");
  const openSalyRegistBtn  = document.getElementById("openSalyRegistModal");

  function applyTabFilter() {
    if (currentTabStatus === "PAID") {
      // sal3 = 지급완료
      gridData = originalGridData.filter(row => row.salyLedgSt === "sal3");
    } else {
      // 지급전: sal1(미확정) + sal2(확정)
      gridData = originalGridData.filter(row => row.salyLedgSt !== "sal3");
    }
    grid.resetData(gridData);

    const isPaidTab = currentTabStatus === "PAID";

    if (btnSalyDelete) {
      btnSalyDelete.style.display = isPaidTab ? "none" : "";
      btnSalyDelete.disabled      = isPaidTab;
    }
    if (btnSalyCalc) {
      btnSalyCalc.style.display   = isPaidTab ? "none" : "";
      btnSalyCalc.disabled        = isPaidTab;
    }
    if (btnToggleConfirm) {
      btnToggleConfirm.style.display = isPaidTab ? "none" : "";
      btnToggleConfirm.disabled      = isPaidTab;
    }
    if (openSalyRegistBtn) {
      openSalyRegistBtn.style.display = isPaidTab ? "none" : "";
      openSalyRegistBtn.disabled      = isPaidTab;
    }
    if (btnSalySpec) {
      btnSalySpec.style.display = "";
      btnSalySpec.disabled      = false;
    }

    updateConfirmButtonLabel();
  }

  statusTabs.forEach(tab => {
    tab.addEventListener("click", function () {
      statusTabs.forEach(t => t.classList.remove("active"));
      this.classList.add("active");
      currentTabStatus = this.dataset.status || "BEFORE_PAY";
      applyTabFilter();
    });
  });

  /*************************
   * 6. 확정/확정취소 토글 버튼
   *************************/
  function updateConfirmButtonLabel() {
    if (!btnToggleConfirm) return;

    const selected = getSelectedRow();
    if (!selected) {
      btnToggleConfirm.textContent = "확정/취소";
      return;
    }

    const { row } = selected;
    const code = row.salyLedgSt;

    if (code === "sal1") {
      btnToggleConfirm.textContent = "확정";
    } else if (code === "sal2") {
      btnToggleConfirm.textContent = "확정취소";
    } else if (code === "sal3") {
      btnToggleConfirm.textContent = "확정";
    }
  }

  if (btnToggleConfirm) {
    btnToggleConfirm.addEventListener("click", () => {
      const selected = getSelectedRow();
      if (!selected) {
        alert("확정/취소할 급여대장을 선택해주세요.");
        return;
      }

      const { rowKey, row } = selected;
      const code = row.salyLedgSt;

      if (code === "sal3") {
        alert("지급완료된 급여대장은 확정 상태를 변경할 수 없습니다.");
        return;
      }

      // sal1(미확정) <-> sal2(확정) 토글 (프론트 표현만)
      if (code === "sal1") {
        grid.setValue(rowKey, "salyLedgSt", "sal2");
        grid.setValue(rowKey, "salyLedgStNm", "확정");
      } else if (code === "sal2") {
        grid.setValue(rowKey, "salyLedgSt", "sal1");
        grid.setValue(rowKey, "salyLedgStNm", "미확정");
      }

      updateConfirmButtonLabel();

      // TODO: 실제 DB 업데이트 API(/insa/saly/confirm) 붙이면 여기서 호출
    });
  }

  grid.on("click", ev => {
    const target = ev.target;
    if (target instanceof HTMLElement &&
        target.matches('input[type="radio"][name="salyLedgRadio"]')) {
      updateConfirmButtonLabel();
    }
  });

  /*************************
   * 7. 삭제 버튼 (API 연동)
   *************************/
  if (btnSalyDelete) {
    btnSalyDelete.addEventListener("click", () => {
      const selected = getSelectedRow();
      if (!selected) {
        alert("삭제할 급여대장을 선택해주세요.");
        return;
      }
      const { row } = selected;

      if (!confirm("선택한 급여대장을 삭제하시겠습니까?")) {
        return;
      }

      fetch("/insa/saly/delete", {
        method : "POST",
        headers: { "Content-Type": "application/json" },
        body   : JSON.stringify({ salyLedgId: row.salyLedgId })
      })
      .then(res => res.json())
      .then(body => {
        if (!body || body.result !== "SUCCESS") {
          const msg = (body && body.message) || "삭제 중 오류가 발생했습니다.";
          alert(msg);
          return;
        }
        alert("삭제되었습니다.");
        loadSalyList();
      })
      .catch(err => {
        console.error("급여대장 삭제 오류", err);
        alert("급여대장 삭제 중 오류가 발생했습니다.");
      });
    });
  }

  /***********************
   * 9. 모달 & 사원 그리드
   ***********************/
  const modal   = document.getElementById("salyRegistModal");
  const back    = document.getElementById("salyRegistBackdrop");
  const btnSalySave = document.getElementById("btnSalySave");
  const btnSalyEmpSearch = document.getElementById("btnSalyEmpSearch");
  const salyEmpNmCond = document.getElementById("salyEmpNmCond");
  const modalDept = document.getElementById("salyDept");

  const grid2El = document.getElementById("grid2");
  let grid2 = null;

  // 수정 모드 플래그
  let editMode = false;
  let editingSalyLedgId = null;
  // 수정 시 초기 체크할 사원 ID 목록
  let initialCheckedEmpIds = [];

  function initEmpGrid() {
    if (!grid2El || grid2) return;
    grid2 = new tui.Grid({
      el: grid2El,
      data: [],
      bodyHeight: 320,
      scrollX: false,
      scrollY: true,
      rowHeaders: ['checkbox'],
      columns: [
        { header: "사원번호", name: "empId" },
        { header: "사원명",   name: "nm" },
        { header: "고용형태", name: "emplymTyNm" },
        { header: "부서명",   name: "deptNm" }
      ]
    });
  }

  function applyCheckedEmpIdsToGrid2() {
    if (!grid2 || !initialCheckedEmpIds || initialCheckedEmpIds.length === 0) return;
    const rows = grid2.getData();
    rows.forEach(row => {
      if (initialCheckedEmpIds.includes(row.empId)) {
        grid2.check(row.rowKey);
      }
    });
  }

  function loadEmpList() {
    if (!grid2) return;

    const deptId = modalDept ? (modalDept.value || "") : "";
    const empNm  = salyEmpNmCond ? salyEmpNmCond.value.trim() : "";

    const param = {
      deptId: deptId,
      empNm : empNm
    };

    fetch("/insa/saly/empList", {
      method : "POST",
      headers: { "Content-Type": "application/json" },
      body   : JSON.stringify(param)
    })
    .then(res => res.json())
    .then(list => {
      const data = (list || []).map(e => ({
        empId:      e.empId,
        nm:         e.nm,
        emplymTyNm: e.emplymTyNm || e.emplymTy || "",
        deptNm:     e.deptNm || ""
      }));
      grid2.resetData(data);
      // 수정 모드일 때 기존 사원 체크
      applyCheckedEmpIdsToGrid2();
    })
    .catch(err => {
      console.error("사원 조회 오류", err);
      alert("사원 목록 조회 중 오류가 발생했습니다.");
    });
  }

  /***********************
   * 9-1. 귀속연월/지급일자 datepicker 초기화 함수
   *      - 귀속연월: 지난 달까지 선택 가능
   *      - 지급일자: 오늘 이전 날짜 선택 불가
   ***********************/
  function initRevsYmPicker() {
    const $revsYm = $("#revs_ym");
    if (!$revsYm.length) return;

    if ($revsYm.data("datepicker")) {
      $revsYm.datepicker("destroy");
    }

    const today = new Date();
    // 지난 달의 마지막 날 (예: 오늘이 12월이면 11월 30일)
    const lastMonthLastDay = new Date(today.getFullYear(), today.getMonth(), 0);

    $revsYm
      .datepicker({
        format: "yyyy-mm",
        autoclose: true,
        minViewMode: 1,   // 월 단위
        language: "ko",
        endDate: lastMonthLastDay
      })
      .on("show", function () {
        const $self  = $(this);
        const $modal = $self.closest(".modal");
        if (!$modal.length) return;

        const modalZ = parseInt($modal.css("z-index"), 10) || 1055;
        setTimeout(function () {
          $(".datepicker-dropdown").each(function () {
            this.style.setProperty(
              "z-index",
              String(modalZ + 10),
              "important"
            );
          });
        }, 0);
      });
  }

  function initPayDtPicker() {
    const $payDt = $("#payDt");
    if (!$payDt.length) return;

    if ($payDt.data("datepicker")) {
      $payDt.datepicker("destroy");
    }

    const today = new Date();
    const todayZero = new Date(
      today.getFullYear(),
      today.getMonth(),
      today.getDate()
    );

    $payDt
      .datepicker({
        format: "yyyy-mm-dd",
        autoclose: true,
        language: "ko",
        startDate: todayZero,
        beforeShowDay: function (date) {
          const d = new Date(date.getFullYear(), date.getMonth(), date.getDate());
          if (d < todayZero) {
            return false;
          }
          return true;
        }
      })
      .on("show", function () {
        const $self  = $(this);
        const $modal = $self.closest(".modal");
        if (!$modal.length) return;

        const modalZ = parseInt($modal.css("z-index"), 10) || 1055;
        setTimeout(function () {
          $(".datepicker-dropdown").each(function () {
            this.style.setProperty(
              "z-index",
              String(modalZ + 10),
              "important"
            );
          });
        }, 0);
      });
  }

  function openSalyModal() {
    if (!modal || !back) return;

    modal.classList.add("show");
    modal.style.display = "block";
    back.style.display  = "block";

    // ✅ 모달이 열릴 때마다 datepicker 재초기화
    initRevsYmPicker();
    initPayDtPicker();

    initEmpGrid();
    loadEmpList();

    if (grid2 && grid2.refreshLayout) {
      grid2.refreshLayout();
    }
  }

  function closeSalyRegistModal() {
    if (modal) {
      modal.classList.remove("show");
      modal.style.display = "none";
    }
    if (back) {
      back.style.display = "none";
    }
    editMode = false;
    editingSalyLedgId = null;
    initialCheckedEmpIds = [];
  }

  if (openSalyRegistBtn) {
    openSalyRegistBtn.addEventListener("click", () => {
      const selected = getSelectedRow();

      if (!selected) {
        // 신규 모드
        editMode = false;
        editingSalyLedgId = null;
        initialCheckedEmpIds = [];

        // 모달 폼 초기화
        if (window.TeamCommon && TeamCommon.modal && typeof TeamCommon.modal.reset === "function") {
          TeamCommon.modal.reset(modal);
        }

        openSalyModal();
      } else {
        // 수정 모드
        const { row } = selected;
        editMode = true;
        editingSalyLedgId = row.salyLedgId;
        initialCheckedEmpIds = [];

        fetch("/insa/saly/detail?salyLedgId=" + encodeURIComponent(row.salyLedgId))
          .then(res => res.json())
          .then(vo => {
            if (!vo || !vo.salyLedgId) {
              alert("급여대장 정보를 불러오지 못했습니다.");
              return;
            }

            initialCheckedEmpIds = Array.isArray(vo.empIdList) ? vo.empIdList : [];

            // 모달 열고 값 세팅
            openSalyModal();
            fillSalyModal(vo);

            // 사원 체크 반영(그리드 데이터 로딩 이후에도 한 번 더)
            setTimeout(applyCheckedEmpIdsToGrid2, 0);
          })
          .catch(err => {
            console.error("급여대장 상세 조회 오류", err);
            alert("급여대장 상세 조회 중 오류가 발생했습니다.");
          });
      }
    });
  }

  function fillSalyModal(vo) {
    const salyNmInput = document.getElementById("salyNm");
    const revsYmInput = document.getElementById("revs_ym");
    const payDtInput  = document.getElementById("payDt");

    if (salyNmInput) salyNmInput.value = vo.salyLedgNm || "";
    if (revsYmInput) revsYmInput.value = vo.revsYm || "";
    if (payDtInput)  payDtInput.value  = vo.payDt || "";

    // datepicker 실제 값도 업데이트
    const revsYm = vo.revsYm || null;
    const payDt  = vo.payDt || null;

    if (revsYm && $('#revs_ym').data('datepicker')) {
      $('#revs_ym').datepicker('update', revsYm);
    }
    if (payDt && $('#payDt').data('datepicker')) {
      $('#payDt').datepicker('update', payDt);
    }
  }

  if (back) {
    back.addEventListener("click", closeSalyRegistModal);
  }
  if (modal) {
    modal.addEventListener("click", function (e) {
      if (!e.target.closest(".modal-content")) {
        closeSalyRegistModal();
      }
    });
  }
  document.addEventListener("keydown", function (e) {
    if (e.key === "Escape") {
      closeSalyRegistModal();
    }
  });

  // 사원 검색 버튼 + 엔터 + 부서 변경
  btnSalyEmpSearch?.addEventListener("click", loadEmpList);
  salyEmpNmCond?.addEventListener("keydown", e => {
    if (e.key === "Enter") {
      loadEmpList();
    }
  });
  modalDept?.addEventListener("change", loadEmpList);

  /***********************
   * 11. 급여대장 저장 (신규/수정 공통)
   ***********************/
  const btnSalySaveEl = document.getElementById("btnSalySave");
  if (btnSalySaveEl) {
    btnSalySaveEl.addEventListener("click", () => {
      const salyNmInput = document.getElementById("salyNm");
      const revsYmInput = document.getElementById("revs_ym");
      const payDtInput  = document.getElementById("payDt");

      const salyNm = salyNmInput ? salyNmInput.value.trim() : "";
      const revsYm = revsYmInput ? revsYmInput.value.trim() : "";
      const payDt  = payDtInput ? payDtInput.value.trim() : "";

      if (!salyNm) {
        alert("급여대장명칭을 입력하세요.");
        return;
      }
      if (!revsYm) {
        alert("귀속연월을 선택하세요.");
        return;
      }
      if (!payDt) {
        alert("지급일자를 선택하세요.");
        return;
      }
      if (!grid2) {
        alert("사원 목록 그리드가 초기화되지 않았습니다.");
        return;
      }

      const checkedRows = grid2.getCheckedRows();
      if (!checkedRows || checkedRows.length === 0) {
        alert("급여명세서를 생성할 사원을 한 명 이상 선택하세요.");
        return;
      }

      const empIdList = checkedRows.map(r => r.empId);
      const isEdit = editMode && editingSalyLedgId;

      const payload = {
        salyLedgId : isEdit ? editingSalyLedgId : null,
        salyLedgNm : salyNm,
        revsYm     : revsYm,
        payDt      : payDt,
        empIdList  : empIdList
      };

      fetch("/insa/saly/save", {
        method : "POST",
        headers: { "Content-Type": "application/json" },
        body   : JSON.stringify(payload)
      })
      .then(res => res.json())
      .then(body => {
        if (body.result !== "SUCCESS") {
          const msg = body.message || "저장 중 오류가 발생했습니다.";
          alert(msg);
          return;
        }

        alert("저장되었습니다.");

        loadSalyList();
        closeSalyRegistModal();
      })
      .catch(err => {
        console.error("급여대장 저장 오류", err);
        alert("급여대장 저장 중 오류가 발생했습니다.");
      });
    });
  }

  /***********************
   * 12. 페이지 로드 시 초기작업
   ***********************/
  document.addEventListener("DOMContentLoaded", () => {
    loadDeptOptions();
    loadSalyList();
  });
</script>
</body>
</html>
