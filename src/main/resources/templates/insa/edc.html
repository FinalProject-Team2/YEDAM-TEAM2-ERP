<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout}">
<head>
<meta charset="UTF-8">
<title>vcatn.html</title>
<link rel="stylesheet"
	href="https://uicdn.toast.com/grid/latest/tui-grid.css" />
<script src="https://uicdn.toast.com/grid/latest/tui-grid.js"></script>
<style>
.form-select {
	color: #000 !important;
}
/* 추가 CSS */
.readonly-input[readonly] {
	background-color: #e9ecef; /* Bootstrap 기본 disabled 색상 */
	cursor: not-allowed; /* 마우스 커서도 입력 불가 느낌 */
}

.stIsShow {
	display: none;
}
</style>
</head>
<body layout:fragment="content">
	<div class="row">
		<div class="col-md-12">
			<div class="card mb-3">
				<!-- 카드 헤더 : 제목 + 초기화/조회 버튼 -->
				<div class="card-header with-actions">
					<div class="card-header-left">
						<h5 class="card-title">조회</h5>
						<i class="fa fa-download"></i>
					</div>
					<div class="card-header-right">
						<button type="button" class="btn btn-dark">초기화</button>
						<button type="button" class="btn btn-outline-dark">조회</button>
					</div>
				</div>
				<div class="card-body">

					<div class="row mb-2">
						<div class="col-md-3">
							<label class="form-label">교육명</label> <input type="text"
								class="form-control" placeholder="Value">
						</div>

						<div class="col-md-3">
							<label class="form-label">휴가유형</label> <select
								class="form-select">
								<option>연차</option>
								<option>병가</option>
								<option>특별휴가</option>
							</select>
						</div>
						<div class="col-md-3">
							<label class="form-label">연도</label> <select id="year"
								class="form-select"></select>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="row">
		<!-- 검색조건 -->
		<div class="col-md-6">
			<!-- 사원목록 -->
			<div class="card" style="height: 710px;">
				<!-- 카드 헤더 : 제목 + 초기화/조회 버튼 -->
				<div class="card-header with-actions">
					<div class="card-header-left">
						<h5 class="card-title">교육 목록 테이블</h5>
					</div>
				</div>
				<div class="card-body">

					<div id="toastGrid" style="margin: 20px;"></div>
				</div>
			</div>
		</div>
		<!-- 우측 패널 -->
		<div class="col-md-6">
			<!-- 기본정보 -->
			<div class="card mb-3">
				<!-- 카드 헤더 : 제목 + 초기화/조회 버튼 -->
				<div class="card-header with-actions">
					<div class="card-header-left">
						<h5 class="card-title">교육 기본 정보</h5>
					</div>
					<div class="card-header-right">
						<button class="btn btn-outline-dark " id="openModal">등록</button>
						<button class="btn btn-outline-dark ">삭제</button>
					</div>
				</div>
				<div class="card-body">


					<div class="row">
						<div class="col-md-12">
							<div class="row mb-2">
								<div class="col-md-6">
									<label class="form-label">교육명</label> <input type="text"
										class="form-control" />
								</div>
								<div class="col-md-6">
									<label class="form-label">교육구분</label> <input type="text"
										class="form-control" />
								</div>
							</div>
							<div class="row mb-2">
								<div class="col-md-6">
									<label class="form-label">대상자 수</label> <input id="v_vcatnTy"
										class="form-control" />
								</div>
								<div class="col-md-6">
									<label for="userName" class="form-label">등록일</label>
									<div class="input-group date" id="applyDatePicker">
										<input type="text" class="form-control" id="v_creaDt"
											placeholder="날짜 선택"> <span class="input-group-text"
											id="icon-calendar"> <i class="bi bi-calendar"></i>
										</span>
									</div>
								</div>
							</div>
							<div class="row mb-2">
								<div class="col-md-6">
									<label for="userName" class="form-label">기간</label>
									<div class="input-group date" id="applyDatePicker">
										<input type="text" class="form-control" id="v_edcBeginDt"
											placeholder="날짜 선택"> <span class="input-group-text"
											id="icon-calendar"> <i class="bi bi-calendar"></i>
										</span>
									</div>
								</div>
								<div class="col-md-6">
									<label for="userName" class="form-label"> </label>
									<div class="input-group date" id="applyDatePicker">
										<input type="text" class="form-control" id="v_edcEndDt"
											placeholder="날짜 선택"> <span class="input-group-text"
											id="icon-calendar"> <i class="bi bi-calendar"></i>
										</span>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<!-- 인사정보 -->
			<div class="card">
				<!-- 카드 헤더 : 제목 + 초기화/조회 버튼 -->
				<div class="card-header with-actions">
					<div class="card-header-left">
						<h5 class="card-title">대상자 목록</h5>
					</div>
				</div>
				<div class="card-body " style="height: 345.45px;">


					<div id="toastGrid2" style="margin: 20px;"></div>

				</div>
			</div>
		</div>
	</div>

	<!-- 모달 -->
	<div class="modal fade" id="myModal">
		<div class="modal-dialog modal-dialog-centered">
			<div class="modal-content">		
				<!-- 바디 -->
				<div class="modal-body">
					<div class="row mb-2">
						<div class="col-md-9">
							<h5 class="modal-title">법정의무교육 등록</h5>
						</div>
						<div class="col-md-3">
							<button class="btn btn-outline-dark " >등록</button>
						</div>
					</div>
					<div class="row mb-2">
						<div class="col-md-6">
							<label class="form-label">교육명</label> <input type="text"
								class="form-control" />
						</div>
						<div class="col-md-6">
							<label class="form-label">교육구분</label> <input type="text"
								class="form-control" />
						</div>
					</div>
					<div class="row mb-2">
						<div class="col-md-6">
							<label class="form-label">기관명</label> <input type="text"
								class="form-control" />
						</div>
						<div class="col-md-6">
							<label class="form-label">강사</label> <input type="text"
								class="form-control" />
						</div>
					</div>
					<div class="row mb-2">
						<div class="col-md-6">
							<label class="form-label">교육 시작날짜</label> <input type="date"
								class="form-control" />
						</div>
						<div class="col-md-6">
							<label class="form-label">교육 종료날짜</label> <input type="date"
								class="form-control" />
						</div>
					</div>
					<div class="row mb-2">
						<div class="col-md-6">
							<label class="form-label">수료기준</label> <input type="text"
								value="" class="form-control" />
						</div>
						<div class="col-md-6">
							<label class="form-label">교육대상자 선정범위</label> <select
								class="form-select">								
									<option value="전체">전체</option>		
								<optgroup label="직무">									
									<option>HRM(인적자원관리)</option>
									<th:block th:each="job : ${jobs}">
										<option th:value="${job.id}" th:text="${job.name}"></option>
									</th:block>
								</optgroup>
								<optgroup label="직급">
									<option>사원</option>
									<option>대리</option>
									<option>과장</option>
									<option>부장</option>
									<option>이사</option>
								</optgroup>
								<optgroup label="부서">
									<option>팀원</option>
									<option>팀장</option>
									<option>관리자</option>
									<option>임원</option>
								</optgroup>
							</select>
						</div>
					</div>
					<div class="row mb-2">
						<div class="col-md-6">
							<label class="form-label">교육명</label> <input type="text"
								class="form-control" />
						</div>

					</div>
				</div>

				

			</div>
		</div>
	</div>

	<script>
		const select = document.getElementById("year");
		const currentYear = new Date().getFullYear(); // 현재 연도
		const startYear = 1980; // 시작 연도

		for (let y = currentYear; y >= startYear; y--) {
			const option = document.createElement("option");
			option.value = y;
			option.textContent = y;
			select.appendChild(option);
		}

		

		const gridData = [ {
			edcNm : "산업안전보건교육",
			edcTy : "법정의무교육",
			edcCnt : "150",
			compl : "100%",
			creaDt : "2025.11.26"			
		}, {
			edcNm : "산업안전보건교육",
			edcTy : "법정의무교육",
			edcCnt : "150",
			compl : "100%",
			creaDt : "2025.11.26"			
		}, {
			edcNm : "산업안전보건교육",
			edcTy : "법정의무교육",
			edcCnt : "150",
			compl : "100%",
			creaDt : "2025.11.26"			
		}, {
			edcNm : "산업안전보건교육",
			edcTy : "법정의무교육",
			edcCnt : "150",
			compl : "100%",
			creaDt : "2025.11.26"			
		}, {
			edcNm : "산업안전보건교육",
			edcTy : "법정의무교육",
			edcCnt : "150",
			compl : "100%",
			creaDt : "2025.11.26"			
		}, {
			edcNm : "산업안전보건교육",
			edcTy : "법정의무교육",
			edcCnt : "150",
			compl : "100%",
			creaDt : "2025.11.26"			
		}, {
			edcNm : "산업안전보건교육",
			edcTy : "법정의무교육",
			edcCnt : "150",
			compl : "100%",
			creaDt : "2025.11.26"			
		}, {
			edcNm : "산업안전보건교육",
			edcTy : "법정의무교육",
			edcCnt : "150",
			compl : "100%",
			creaDt : "2025.11.26"			
		}, {
			edcNm : "산업안전보건교육",
			edcTy : "법정의무교육",
			edcCnt : "150",
			compl : "100%",
			creaDt : "2025.11.26"			
		}, {
			edcNm : "산업안전보건교육",
			edcTy : "법정의무교육",
			edcCnt : "150",
			compl : "100%",
			creaDt : "2025.11.26"			
		}, {
			edcNm : "산업안전보건교육",
			edcTy : "법정의무교육",
			edcCnt : "150",
			compl : "100%",
			creaDt : "2025.11.26"			
		}, {
			edcNm : "산업안전보건교육",
			edcTy : "법정의무교육",
			edcCnt : "150",
			compl : "100%",
			creaDt : "2025.11.26"			
		}, {
			edcNm : "산업안전보건교육",
			edcTy : "법정의무교육",
			edcCnt : "150",
			compl : "100%",
			creaDt : "2025.11.26"			
		},

		];

		// Grid 생성
		const grid = new tui.Grid({
			el : document.getElementById('toastGrid'),
			data : gridData,
			scrollX : false,
			scrollY : true,
			minBodyHeight : 0,
			autoWidth : true,
			columns : [ {
				header : '교육명',
				name : 'edcNm',
				sortable : 'true'
			}, {
				header : '교육구분',
				name : 'edcTy'
			}, {
				header : '대상인원',
				name : 'edcCnt',
				align : 'right'
			}, {
				header : '수료율',
				name : 'compl',
				align : 'right'
			}, {
				header : '등록일',
				name : 'creaDt',
				align : 'center'
			} ],
			bodyHeight : 520, // 본문 높이 고정
		});
		
		const gridData2 = [ {
			edcNm : "교육교육",
			nm : "김길동",
			deptNm : "영업",
			complSt : "미수료"						
		}, {
			edcNm : "교육교육",
			nm : "김길동",
			deptNm : "영업",
			complSt : "수료"						
		}, {
			edcNm : "교육교육",
			nm : "김길동",
			deptNm : "영업",
			complSt : "반려"						
		}, {
			edcNm : "교육교육",
			nm : "김길동",
			deptNm : "영업",
			complSt : "미수료"						
		}, 

		];

		
		
		class downloadFunc {
			  constructor(props) {

			    // 현재 행 데이터 가져오기
			    const row = props.grid.getRow(props.rowKey);

			    // 미수료일 경우 빈 요소 반환
			    if (row.complSt === "미수료") {
			      this.el = document.createElement("div"); // 빈 셀
			      return;
			    }

			    // --- 수료일 경우에만 아이콘 표시 ---
			    const button = document.createElement('button');
			    button.innerHTML = '<i class="fa fa-download"></i>';

			    button.style.border = "none";
			    button.style.background = "transparent";
			    button.style.cursor = "pointer";
			    button.style.fontSize = "20px";
			    button.style.color = "#333";

			    button.addEventListener("click", () => {
			      const rowKey = props.rowKey;
			      const row = props.grid.getRow(rowKey);

			      fetch(`/api/get-file-name?id=${row.id}`)
			        .then(res => res.json())
			        .then(data => {
			          const fileName = data.fileName;

			          const link = document.createElement("a");
			          link.href = `/images/download/${fileName}`;
			          link.download = fileName;

			          document.body.appendChild(link);
			          link.click();
			          link.remove();
			        })
			        .catch(err => {
			          console.error("Download error:", err);
			          alert("파일 다운로드 중 오류가 발생했습니다.");
			        });
			    });

			    this.el = button;
			  }

			  getElement() {
			    return this.el;
			  }
			}



		
		// Grid2 생성
		const grid2 = new tui.Grid({
			el : document.getElementById('toastGrid2'),
			data : gridData2,
			scrollX : false,
			scrollY : true,
			minBodyHeight : 0,
			autoWidth : true,
			columns : [ {
				header : '사번',
				name : 'edcNm',
				sortable : 'true'
			}, {
				header : '이름',
				name : 'nm'
			}, {
				header : '부서',
				name : 'deptNm'				
			}, {
				header : '수료여부',
				name : 'complSt',
				align : 'center'
			}, {
				header : '수료증파일',
				name : 'complFile',
				align : 'center',
				renderer: downloadFunc
			} ],
			bodyHeight : 200, // 본문 높이 고정
		});
		
		const modal = document.getElementById("myModal");
		const openBtn = document.getElementById("openModal");
		

		openBtn.addEventListener("click", () => {
		  modal.classList.add("show");
		  modal.style.display = "block"; // 기본은 display:none → block으로 변경
		  document.body.classList.add("modal-open"); // 스크롤 막기
		});

		function closeModal() {
		  modal.classList.remove("show");
		  modal.style.display = "none";
		  document.body.classList.remove("modal-open");
		}

		

		// 모달 영역 밖 클릭 시 닫기
		modal.addEventListener("click", (event) => {
		  // 클릭한 요소가 .modal-content 내부가 아니면 닫기
		  if (!event.target.closest(".modal-content")) {
		    closeModal();
		  }
		});
	</script>
	<script type="module">
import { bindGridToForm, formToJson } from '/assets/js/teamExportUtil.js';

//그리드 행 클릭 시 상세정보 입력
grid.on('click', function(ev) {
    const rowData = grid.getRow(ev.rowKey);
    if (!rowData) return;

    bindGridToForm(rowData);    
    
    const dto = formToJson();  
    console.log(dto);
});
</script>
</body>

</html>