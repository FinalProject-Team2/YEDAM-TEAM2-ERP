<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
    <meta charset="UTF-8">
    <title>사원 계정 관리</title>

    <!-- Toast UI Grid -->
    <link rel="stylesheet" href="https://uicdn.toast.com/grid/latest/tui-grid.css" />
    <script src="https://uicdn.toast.com/grid/latest/tui-grid.js"></script>

    <style>
        .form-select {
            color: #000 !important;
        }

        .emp-account-wrapper .card-title {
            font-weight: 600;
            font-size: 1.1rem;
        }

        .emp-account-wrapper #empGrid,
        .emp-account-wrapper #roleGrid {
            width: 100%;
            margin-top: 4px;
        }

        .emp-account-wrapper .help-text {
            font-size: 12px;
            color: #6c757d;
        }

        /* 카드 헤더(제목 + 버튼) 공통 스타일 */
        .emp-account-wrapper .card-header.with-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .emp-account-wrapper .card-header-left {
            display: flex;
            align-items: center;
        }
        .emp-account-wrapper .card-header-left .card-title {
            margin-bottom: 0;
        }
        .emp-account-wrapper .card-header-right .btn {
            margin-left: .25rem;
        }

        /* 역할 Grid 헤더 체크박스 가운데 정렬용 */
        #roleGrid .tui-grid-header .tui-grid-cell-content {
            display: flex;
            justify-content: center;
            align-items: center;
        }
    </style>
</head>

<body layout:fragment="content">
<div class="emp-account-wrapper">

    <!-- 사원 조회 카드 -->
    <div class="row">
        <div class="col-md-12 mb-3">
            <div class="card">
                <div class="card-header with-actions">
                    <div class="card-header-left">
                        <h5 class="card-title">사원 조회</h5>
                    </div>
                    <div class="card-header-right">
                        <button class="btn btn-dark">초기화</button>
                        <button class="btn btn-outline-dark">조회</button>
                    </div>
                </div>

                <div class="card-body">
                    <div class="row mb-2">
                        <div class="col-md-3">
                            <label for="deptName">부서 명</label>
                            <select id="deptName" class="form-select">
                                <option value="">YEDAM</option>
                                <option value="HR">인사</option>
                                <option value="SALES">영업</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label for="jobName">직급 명</label>
                            <select id="jobName" class="form-select">
                                <option value="">YEDAM</option>
                                <option>사원</option>
                                <option>대리</option>
                                <option>과장</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label for="empName">사원 이름</label>
                            <input id="empName" type="text" class="form-control" placeholder="홍길동">
                        </div>
                        <div class="col-md-3">
                            <label for="accountId">계정 ID</label>
                            <input id="accountId" type="text" class="form-control" placeholder="HONG@HONG.AC">
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- 사원 목록 + 사원 계정 정보 / 계정 역할 설정 -->
    <div class="row">
        <!-- 좌측 : 사원 목록 -->
        <div class="col-md-7">
            <div class="card mb-3">
                <div class="card-header with-actions">
                    <div class="card-header-left">
                        <h5 class="card-title me-2">사원 목록</h5>
                        <span class="help-text">
                            * 사원 목록에서 대상을 선택하면 오른쪽에서 계정을 생성·변경할 수 있습니다.
                            계정 상태에 따라 임시 비밀번호 발급 및 문자 전송 방식이 달라집니다.
                        </span>
                    </div>
                    <div class="card-header-right"></div>
                </div>

                <div class="card-body">
                    <div id="empGrid"></div>
                </div>
            </div>
        </div>

        <!-- 우측 : 사원 계정 정보 + 계정 역할 설정 -->
        <div class="col-md-5">

            <!-- 사원 계정 정보 카드 -->
            <div class="card mb-3">
                <div class="card-header with-actions">
                    <div class="card-header-left">
                        <h5 class="card-title">사원 계정 정보</h5>
                    </div>
                    <div class="card-header-right">
                        <button type="button" class="btn btn-outline-dark">저장</button>
                    </div>
                </div>

                <div class="card-body">
                    <div class="row mb-2">
                        <div class="col-md-6">
                            <label>부서 명</label>
                            <input type="text" class="form-control form-control-sm" placeholder="YEDAM">
                        </div>
                        <div class="col-md-6">
                            <label>직급 명</label>
                            <input type="text" class="form-control form-control-sm" placeholder="사원">
                        </div>
                    </div>

                    <div class="row mb-2">
                        <div class="col-md-6">
                            <label>사번</label>
                            <input type="text" class="form-control form-control-sm" placeholder="2511001">
                        </div>
                        <div class="col-md-6">
                            <label>사원 명</label>
                            <input type="text" class="form-control form-control-sm" placeholder="홍길동">
                        </div>
                    </div>

                    <div class="row mb-2">
                        <div class="col-md-6">
                            <label>연락처</label>
                            <input type="text" class="form-control form-control-sm" placeholder="010-1111-1234">
                        </div>
                        <div class="col-md-6">
                            <label>이메일</label>
                            <input type="email" class="form-control form-control-sm" placeholder="YEDAM@YEDAM.AC">
                        </div>
                    </div>

                    <div class="row mb-2">
                        <div class="col-md-6">
                            <label>회사 코드</label>
                            <input type="text" class="form-control form-control-sm" placeholder="CO_YEDAM001">
                        </div>
                        <div class="col-md-6">
                            <label>아이디</label>
                            <input type="text" class="form-control form-control-sm" placeholder="HONG@HONG.AC">
                        </div>
                    </div>

                    <div class="row mb-1">
                        <div class="col-md-6">
                            <label>계정 상태</label>
                            <select class="form-select form-select-sm">
                                <option>ACTIVE</option>
                                <option>LOCKED</option>
                                <option>INACTIVE</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 계정 역할 설정 카드 -->
            <div class="card mb-3">
                <div class="card-header with-actions">
                    <div class="card-header-left">
                        <h5 class="card-title me-2 mb-0">계정 역할 설정</h5>
                        <span class="help-text">※ 계정이 존재할 경우, 설정 가능합니다.</span>
                    </div>
                    <div class="card-header-right">
                        <button type="button" class="btn btn-outline-dark">역할 조회</button>
                        <button type="button" class="btn btn-outline-dark">저장</button>
                        <button type="button" class="btn btn-danger">삭제</button>
                    </div>
                </div>

                <div class="card-body">
                    <div id="roleGrid"></div>
                </div>
            </div>

        </div>
    </div>

</div>

<script>
    // Toast UI Grid 테마
    tui.Grid.applyTheme('default', {
        cell: {
            normal: {
                border: '#dedede',
                background: '#ffffff',
                showVerticalBorder: true
            },
            header: {
                border: '#dedede',
                background: '#f5f5f5',
                showVerticalBorder: true
            },
            editable: {
                background: '#FFFDF0',
                text: '#000'
            },
            selectedHeader: {
                background: '#f5f5f5'
            },
            selected: {
                background: '#ffffff'
            }
        }
    });

    const commonGridOptions = {
        bodyHeight: 260,
        scrollX: false,
        scrollY: false,
        rowHeaders: [],
        columnOptions: {
            minWidth: 80,
            resizable: true
        }
    };

    // 더미 데이터
    const empData = [
        { deptName: 'YEDAM', jobName: '사원', empNo: '2511001', empName: '홍길동', hasAccount: 'Y', status: 'ACTIVE' },
        { deptName: 'YEDAM', jobName: '사원', empNo: '2511002', empName: '김영업', hasAccount: 'N', status: 'LOCKED' },
        { deptName: 'YEDAM', jobName: '과장', empNo: '2511003', empName: '박관리', hasAccount: 'Y', status: 'INACTIVE' }
    ];

    const roleData = [
        { checked: true,  roleName: '인사 담당',     roleType: '인사' },
        { checked: false, roleName: '영업 담당',     roleType: '영업' },
        { checked: false, roleName: '시스템 관리자', roleType: '공통' }
    ];

    // 사원 목록 Grid
    const empGrid = new tui.Grid({
        el: document.getElementById('empGrid'),
        data: empData,
        ...commonGridOptions,
        columns: [
            { header: '부서 명',        name: 'deptName',   minWidth: 100 },
            { header: '직급 명',        name: 'jobName',    minWidth: 100 },
            { header: '사번',           name: 'empNo',      minWidth: 100 },
            { header: '사원 명',        name: 'empName',    minWidth: 120 },
            { header: '계정 존재 유무', name: 'hasAccount', width: 110, align: 'center' },
            { header: '계정 상태',      name: 'status',     minWidth: 100, align: 'center' }
        ]
    });

    // 계정 역할 설정 Grid
    const roleGrid = new tui.Grid({
        el: document.getElementById('roleGrid'),
        data: roleData,
        ...commonGridOptions,
        columns: [
            {
                header: '',            // 텍스트 대신 체크박스 넣을 예정
                name: 'checked',
                width: 70,
                align: 'center',
                formatter: ({ value }) =>
                    `<input type="checkbox" class="role-row-check" ${value ? 'checked' : ''} />`
            },
            { header: '역할 명',   name: 'roleName', minWidth: 140 },
            { header: '역할 유형', name: 'roleType', minWidth: 100 }
        ]
    });

    // 개별 행 클릭 시 checked 토글 (데이터도 같이 변경)
    roleGrid.on('click', ev => {
        if (ev.columnName !== 'checked' || ev.rowKey == null) return;

        const current = roleGrid.getValue(ev.rowKey, 'checked');
        roleGrid.setValue(ev.rowKey, 'checked', !current);
    });

    // 헤더 셀에 "전체 선택" 체크박스 추가
    function addHeaderCheckbox() {
        const headerCell = document.querySelector(
            '#roleGrid .tui-grid-header th[data-column-name="checked"] .tui-grid-cell-content'
        );
        if (!headerCell) return;
        // 이미 생성되어 있으면 다시 만들지 않음
        if (headerCell.querySelector('.role-header-check')) return;

        const headerCheckbox = document.createElement('input');
        headerCheckbox.type = 'checkbox';
        headerCheckbox.className = 'role-header-check';

        headerCheckbox.addEventListener('change', function (e) {
            const checked = e.target.checked;
            const rowCount = roleGrid.getRowCount();

            for (let i = 0; i < rowCount; i++) {
                const row = roleGrid.getRowAt(i);
                roleGrid.setValue(row.rowKey, 'checked', checked);
            }
        });

        headerCell.innerHTML = '';
        headerCell.appendChild(headerCheckbox);
    }

    // 처음 렌더링될 때 헤더 체크박스 주입
    roleGrid.on('afterRender', addHeaderCheckbox);
</script>

</body>
</html>
