<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="store.yd2team.business.mapper.BusinessMapper">
  <!-- 목록 조회 -->
    <select id="getList" resultType="store.yd2team.business.service.BusinessVO">
        SELECT
	            potential_info_no  as potentialInfoNo,
	            potential_cond_no  as potentialCondNo,
	            vend_id            as vendId,
	            rank               as rank,
	            vend_nm            as vendNm,
	            industry_type      as industryType,
	            company_size       as companySize,
	            region             as region,
	             establish_date AS establishDate
        FROM 	tb_potential_cust_list
       ORDER BY potential_info_no desc
    </select>
    
    <select id="existsPotentialInfoNo">
	    SELECT COUNT(*)
	    FROM tb_potential_cust_list
	    WHERE potential_info_no = #{potentialInfoNo}
    </select>

    <!-- 공공데이터 insert -->
    <insert id="insertPotential" parameterType="store.yd2team.business.service.BusinessVO">
        INSERT INTO TB_POTENTIAL_CUST_LIST (
            potential_info_no,
            potential_cond_no,
            vend_id,
            rank,
            vend_nm,
            industry_type,
            company_size,
            region,
            establish_date
        ) VALUES (
            #{potentialInfoNo},
            seq_potential_cond_no.nextval,   <!-- ★ 여기 수정 -->
           'CUST' || LPAD(seq_vend_id.NEXTVAL, 3, '0'),
            seq_rank.nextval,
            #{vendNm},
            #{industryType},
            #{companySize},
            #{region},
            to_date(#{establishDate}, 'yyyy-mm-dd')
        )
    </insert>
    
    <select id="getBusinessList" parameterType="store.yd2team.business.service.BusinessVO"> 
    SELECT
	        potential_info_no,
	        potential_cond_no,
	        vend_id,
	        rank,
	        vend_nm,
	        industry_type,
	        company_size,
	        region,
	        establish_date,
	        crea_dt,
	        crea_by,
	        updt_dt,
	        updt_by
    FROM
      	  	tb_potential_cust_list
    WHERE 1 = 1
	    <if test="industryType != null and industryType != ''">
	        AND industry_type LIKE '%' || #{industryType} || '%'
	    </if>
	    <if test="companySize != null and companySize != ''">
	        AND company_size LIKE '%' || #{companySize} || '%'
	    </if>
	    <if test="region != null and region != ''">
	        AND region 			LIKE '%' || #{region} || '%'
	    </if>
	    <if test="startEstablishDate != null and startEstablishDate != ''">
	        AND establish_date &gt;= TO_DATE(#{startEstablishDate}, 'YYYY-MM-DD')
	    </if>
	    <if test="endEstablishDate != null and endEstablishDate != ''">
	        AND establish_date &lt;= TO_DATE(#{endEstablishDate}, 'YYYY-MM-DD')
	    </if>
    ORDER BY rank
</select>

<select id="getStdrDetailAll" parameterType="store.yd2team.business.service.PotentialStdrVO">
	SELECT
	        STDR_DETAIL_ID   AS stdrDetailId,
	        STDR_ID          AS stdrId,
	        VEND_ID          AS vendId,
	        STDR_ITEAM_INFO  AS stdrIteamInfo,
	        INFO_SCORE       AS infoScore
    FROM 	TB_POTENTIAL_STDR_DETAIL
    ORDER BY INFO_SCORE DESC
</select>
    
</mapper>