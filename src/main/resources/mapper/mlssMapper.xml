<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="store.yd2team.insa.mapper.MlssMapper">

<select id="empIdList">
 SELECT  emp_id
FROM    tb_emp
WHERE   vend_id = #{vendId}
</select>

<select id="mlssCreateId">
SELECT 'mlss' || TO_CHAR(SYSDATE, 'YYMM') ||
       LPAD(NVL(MAX(SUBSTR(mlss_id, LENGTH(mlss_id)-2, 3)), 0) + 1, 3, '0') AS mlss_id
FROM tb_mlss
WHERE SUBSTR(mlss_id, 5, 4) = TO_CHAR(SYSDATE, 'YYMM')
</select>

<insert id="insertMlssList">
  INSERT ALL
  <foreach collection="list" item="item">
    INTO tb_mlss (
      mlss_id, emp_id, mlss_nm, evl_begin_dt, evl_end_dt, suprr, crk, self, crea_dt, crea_by
    ) VALUES (
      #{item.mlssId}, #{item.empId}, #{item.mlssNm}, #{item.evlBeginDt},#{item.evlEndDt}, 0, 0, 0, #{item.creaDt}, 'myk'
    )
  </foreach>
  SELECT 1 FROM DUAL
</insert>

</mapper>
